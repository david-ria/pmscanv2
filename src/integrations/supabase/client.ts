// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Use hardcoded values for reliability in standalone mode
const SUPABASE_URL = "https://shydpfwuvnlzdzbubmgb.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNoeWRwZnd1dm5semR6YnVibWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5NzM1MjcsImV4cCI6MjA2NzU0OTUyN30.l_PAPBy1hlb4J-amKx7qPJ1lPIFseA9GznwL6CcyaQQ";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// Lazy initialization to prevent timing issues
let supabaseClient: any = null;
let isInitialized = false;

// Safe client getter that handles initialization
export const getSupabaseClient = () => {
  if (supabaseClient && isInitialized) {
    return supabaseClient;
  }
  
  if (typeof window === 'undefined') {
    return null; // No client in SSR
  }

  try {
    supabaseClient = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
      auth: {
        storage: localStorage,
        persistSession: true,
        autoRefreshToken: true,
      }
    });
    isInitialized = true;
    return supabaseClient;
  } catch (error) {
    console.error('Failed to create Supabase client:', error);
    return null;
  }
};

// Legacy export for compatibility - but this should not be used directly
export const supabase = new Proxy({} as any, {
  get(target, prop) {
    const client = getSupabaseClient();
    if (!client) {
      console.warn('Supabase client not initialized yet. Use getSupabaseClient() instead.');
      return undefined;
    }
    return client[prop];
  }
});
