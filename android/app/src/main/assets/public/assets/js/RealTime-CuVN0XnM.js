const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/MapGraphToggle-C7STPTe7.js","assets/js/query-BewfWFH7.js","assets/js/vendor-CRCfYjC_.js","assets/js/index-DnKT6hDb.js","assets/js/supabase--OITQzG1.js","assets/js/router-D6wdMmGF.js","assets/js/theme-D-6-9UvQ.js","assets/js/ui-core-CibF-ClQ.js","assets/js/utils-EL5wpLGY.js","assets/js/notifications-6vUXhpBr.js","assets/js/i18n-DZz6YkIP.js","assets/index-BOVYw4lO.css","assets/js/MapboxMapCore-DwX_lmbs.js","assets/js/card-CRF2Wp6a.js","assets/js/badge-D3qJDj1M.js","assets/js/ThresholdContext-1SyiABzf.js","assets/js/loader-circle-CMvZ_kLu.js","assets/js/eventTypes-ynSrOkd7.js","assets/js/PMLineGraph-DB5Ox9c8.js","assets/js/timeFormat-CCn9v1Tp.js","assets/js/charts-Do_EPC5m.js","assets/js/wifi-off-flOeYF_3.js","assets/js/skeleton-D29iA6Gg.js","assets/js/UnifiedDataProvider-D_wn4Ile.js","assets/js/useMissionSaver-CXd3xg0u.js","assets/js/client-zGYq1VIw.js","assets/js/supabaseSafeWrapper-C24d6oy5.js","assets/js/AlertContext-CLzf7XqW.js","assets/js/useGroupSettings-DQBWUHal.js","assets/js/groupConfigs-C_MEEc6R.js","assets/js/useSubscription-DJEgHQrc.js","assets/js/useGroups-DlFUXECJ.js","assets/js/useUserRole-B8Vd-TTd.js","assets/js/ui-forms-BvHfx7SG.js","assets/js/useAutoContext-RU6mHgIo.js","assets/js/bluetooth-BEoGU70i.js","assets/js/useWeatherData-Bov5wL1Q.js","assets/js/useEvents-B2RSjdE6.js","assets/js/select-BZrd-goH.js","assets/js/check-BbmLrf-d.js","assets/js/dialog-DfKWiEIF.js","assets/js/label-Dli8bNIx.js","assets/js/clock-ipAbZE7G.js","assets/js/input-CGNY8--s.js","assets/js/switch-DiHL1fOt.js","assets/js/save-DuXH8Fwl.js","assets/js/trash-2-fnkO6k_f.js","assets/js/bluetooth-CRv2GwO8.js","assets/js/satellite-BoAS3NdR.js","assets/js/useDialog-D4PBCj81.js","assets/js/ContextSelectors-BuR_LYaH.js","assets/js/activity-B8rwkEHL.js","assets/js/AutoContextDisplay-Ba7tQGL7.js","assets/js/brain-BnPjMeLS.js","assets/js/DataLogger-KGSUJsGo.js","assets/js/download-DC3Z7BQM.js"])))=>i.map(i=>d[i]);
import{_ as U}from"./supabase--OITQzG1.js";import{j as e}from"./query-BewfWFH7.js";import{r as a}from"./vendor-CRCfYjC_.js";import{C as T,a as E}from"./card-CRF2Wp6a.js";import{S as B}from"./skeleton-D29iA6Gg.js";import{useThresholds as Ne}from"./ThresholdContext-1SyiABzf.js";import{f as Z,c as O}from"./timeFormat-CCn9v1Tp.js";import{u as L}from"./i18n-DZz6YkIP.js";import{u as te}from"./UnifiedDataProvider-D_wn4Ile.js";import{useAlerts as ye}from"./AlertContext-CLzf7XqW.js";import{f as le,u as be,a as Se,S as we}from"./useAutoContext-RU6mHgIo.js";import{u as Ce,a as Te}from"./useWeatherData-Bov5wL1Q.js";import{c as I,B as y,T as De,u as ae,a as Ee,b as ee}from"./index-DnKT6hDb.js";import{u as ce}from"./useEvents-B2RSjdE6.js";import{M as ie,E as re,a as ke}from"./eventTypes-ynSrOkd7.js";import{S as de,a as me,b as xe,c as ue,d as he,T as Me}from"./select-BZrd-goH.js";import{D as W,a as K,b as H,c as Y,d as Re}from"./dialog-DfKWiEIF.js";import{L as $}from"./label-Dli8bNIx.js";import{C as ge}from"./clock-ipAbZE7G.js";import{I as Pe}from"./input-CGNY8--s.js";import{S as qe}from"./switch-DiHL1fOt.js";import{S as Ae}from"./save-DuXH8Fwl.js";import{T as Le}from"./trash-2-fnkO6k_f.js";import{B as _e}from"./bluetooth-CRv2GwO8.js";import{M as Q,B as se}from"./badge-D3qJDj1M.js";import{S as oe}from"./satellite-BoAS3NdR.js";import{u as Fe}from"./useDialog-D4PBCj81.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=I("BluetoothOff",[["path",{d:"m17 17-5 5V12l-5 5",key:"v5aci6"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M14.5 9.5 17 7l-5-5v4.5",key:"1kddfz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=I("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=I("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=I("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=I("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),ze=({connectionStatus:t,deviceInfo:s,onConnect:d,onDisconnect:r})=>t.connected?e.jsx(T,{className:"w-full",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-success rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Battery: ",s.battery,"% ‚Ä¢ Version: ",s.version]})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:r,className:"text-xs",children:"Disconnect"})]})})}):e.jsx(T,{className:"w-full",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"PMScan Device"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.connecting?"Connecting...":"Not connected"}),t.error&&e.jsx("div",{className:"text-xs text-destructive",children:t.error})]})]}),e.jsxs(y,{onClick:d,disabled:t.connecting,className:"flex-1",children:[e.jsx(_e,{className:"h-4 w-4"}),"Connect Device"]})]})})}),Be=({locationEnabled:t,latestLocation:s,onRequestPermission:d})=>{const r=n=>n<=5?"text-success":n<=10?"text-warning":"text-destructive",o=n=>n<=5?"Excellent":n<=10?"Good":n<=20?"Fair":"Poor";return e.jsxs(T,{className:"p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-lg",children:"GPS Location"})]}),e.jsx(se,{variant:t?"default":"outline",children:t?"Enabled":"Disabled"})]}),t?s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/5 to-primary/10 p-4 rounded-lg border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oe,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Live GPS Coordinates"}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"w-2 h-2 bg-success rounded-full animate-pulse"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Latitude:"}),e.jsxs("span",{className:"font-mono text-lg font-semibold text-primary",children:[s.latitude.toFixed(6),"¬∞"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Longitude:"}),e.jsxs("span",{className:"font-mono text-lg font-semibold text-primary",children:[s.longitude.toFixed(6),"¬∞"]})]}),s.altitude&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Elevation:"}),e.jsxs("span",{className:"font-mono text-lg font-semibold text-primary",children:[s.altitude.toFixed(1),"m"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"GPS Accuracy"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:`font-mono text-sm ${r(s.accuracy)}`,children:["¬±",s.accuracy.toFixed(0),"m"]}),e.jsx(se,{variant:"outline",className:"text-xs",children:o(s.accuracy)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Last Update"}),e.jsx("p",{className:"font-mono text-sm",children:new Date(s.timestamp).toLocaleTimeString()})]})]})]}):e.jsx("div",{className:"text-center py-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx(oe,{className:"h-8 w-8 text-primary mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Waiting for GPS signal..."})]})}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(De,{className:"h-8 w-8 text-warning mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Location access is required to add GPS coordinates to measurements"}),e.jsxs(y,{onClick:d,className:"gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Enable GPS"]})]})]})},Qe=({connectionStatus:t,deviceInfo:s,locationEnabled:d,latestLocation:r,onConnect:o,onDisconnect:n,onRequestLocationPermission:l,className:g})=>t.connected?e.jsx("div",{className:g,children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-card px-4 py-2 rounded-lg border shadow-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Connected"}),e.jsx("button",{onClick:n,className:"ml-2 text-xs text-muted-foreground hover:text-destructive",children:"Disconnect"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-card px-4 py-2 rounded-lg border shadow-sm",children:d&&r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"GPS Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-muted rounded-full"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"No GPS"}),e.jsx("button",{onClick:l,className:"ml-2 text-xs text-primary hover:underline",children:"Enable"})]})})]})}):e.jsx("div",{className:g,children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{connectionStatus:t,deviceInfo:s,onConnect:o,onDisconnect:n}),e.jsx(Be,{locationEnabled:d,latestLocation:r,onRequestPermission:l})]})}),Ue=({open:t,onOpenChange:s,connectionStatus:d,deviceInfo:r,locationEnabled:o,latestLocation:n,onConnect:l,onDisconnect:g,onRequestLocationPermission:c})=>e.jsx(W,{open:t,onOpenChange:s,children:e.jsxs(K,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx(Y,{children:"Connect to PMScan Device"})}),e.jsx("div",{className:"py-4",children:e.jsx(Qe,{connectionStatus:d,deviceInfo:r,locationEnabled:o,latestLocation:n,onConnect:l,onDisconnect:g,onRequestLocationPermission:c})})]})}),We=a.memo(function({currentData:s,isConnected:d}){const{t:r}=L(),{getAirQualityLevel:o}=Ne(),n=a.useMemo(()=>{if(!s||typeof s!="object")return null;const f=typeof s.pm25=="number"?s.pm25:0,h=typeof s.pm1=="number"?s.pm1:0,b=typeof s.pm10=="number"?s.pm10:0;return{pm25:o(f,"pm25"),pm1:o(h,"pm1"),pm10:o(b,"pm10"),roundedValues:{pm1:Math.round(h),pm25:Math.round(f),pm10:Math.round(b)},timestamp:s.timestamp instanceof Date?Z(s.timestamp):Z(O())}},[s,o]);if(!d&&!s)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4",children:Array.from({length:3}).map((f,h)=>e.jsx(T,{className:"text-center",children:e.jsxs(E,{className:"p-4",children:[e.jsx(B,{className:"h-9 w-12 mx-auto mb-2"}),e.jsx(B,{className:"h-4 w-8 mx-auto mb-1"}),e.jsx(B,{className:"h-3 w-10 mx-auto"})]})},h))}),e.jsx("div",{className:"text-center mb-4",children:e.jsx(B,{className:"h-4 w-48 mx-auto"})})]});if(!s||!n)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsx(T,{className:"text-center bg-muted/30",children:e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-muted-foreground mb-1",children:"--"}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM1"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Œºg/m¬≥"})]})}),e.jsx(T,{className:"text-center bg-muted/30",children:e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-muted-foreground mb-1",children:"--"}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM2.5"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Œºg/m¬≥"})]})}),e.jsx(T,{className:"text-center bg-muted/30",children:e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-muted-foreground mb-1",children:"--"}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM10"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Œºg/m¬≥"})]})})]}),e.jsx("div",{className:"text-center text-sm text-muted-foreground mb-4 p-4 bg-muted/20 rounded-lg air-quality-status",children:r("realTime.connectSensor")})]});const{pm25:l,pm1:g,pm10:c,roundedValues:i,timestamp:u}=n;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs(T,{className:"text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundColor:`hsl(var(--${g.color}))`}}),e.jsxs(E,{className:"p-4 relative",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:`hsl(var(--${g.color}))`},children:i.pm1}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM1"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Œºg/m¬≥"})]})]}),e.jsxs(T,{className:"text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundColor:`hsl(var(--${l.color}))`}}),e.jsxs(E,{className:"p-4 relative",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:`hsl(var(--${l.color}))`},children:i.pm25}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM2.5"}),e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Œºg/m¬≥"}),e.jsx("div",{className:"text-xs font-medium px-2 py-1 rounded-full",style:{backgroundColor:`hsl(var(--${l.color}) / 0.2)`,color:`hsl(var(--${l.color}))`},children:r(`realTime.airQuality.${l.level}`)})]})]}),e.jsxs(T,{className:"text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundColor:`hsl(var(--${c.color}))`}}),e.jsxs(E,{className:"p-4 relative",children:[e.jsx("div",{className:"text-3xl font-bold mb-1",style:{color:`hsl(var(--${c.color}))`},children:i.pm10}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"PM10"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Œºg/m¬≥"})]})]})]}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground mb-4",children:[r("realTime.lastMeasurement")," : ",u]})]})});function Ke({showGraph:t,onToggleView:s,isOnline:d,device:r,isConnected:o,onConnect:n,onDisconnect:l,locationEnabled:g,latestLocation:c}){const{t:i}=L();return e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsxs("div",{className:"flex bg-muted p-1 rounded-lg",children:[e.jsxs(y,{variant:t?"ghost":"default",size:"sm",onClick:()=>s(!1),className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),i("realTime.map")]}),e.jsxs(y,{variant:t?"default":"ghost",size:"sm",onClick:()=>s(!0),className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),i("realTime.graph")]})]})}),e.jsx("div",{className:"h-[45vh] relative",children:e.jsx("div",{className:"h-full flex items-center justify-center bg-muted/20 border border-border rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i("realTime.mapWillLoadWhenRecording")})]})})})]})}function He({open:t,onOpenChange:s,recordingFrequency:d,onFrequencyChange:r,onConfirm:o}){const{t:n}=L();return e.jsx(W,{open:t,onOpenChange:s,children:e.jsxs(K,{className:"w-[95vw]",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),n("modals.recordingFrequency.title")]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{children:n("modals.recordingFrequency.chooseMeasureFrequency")}),e.jsxs(de,{value:d,onValueChange:r,children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(ue,{children:le.map(l=>e.jsx(he,{value:l.value,children:n(`modals.frequency.${l.key}`)},l.value))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(y,{variant:"outline",onClick:()=>s(!1),className:"flex-1",children:n("modals.recordingFrequency.cancel")}),e.jsx(y,{onClick:o,className:"flex-1",children:n("modals.recordingFrequency.start")})]})]})]})})}function Ye({open:t,onOpenChange:s,missionName:d,onMissionNameChange:r,shareData:o,onShareDataChange:n,onConfirm:l,onDiscard:g}){const{t:c}=L();return e.jsx(W,{open:t,onOpenChange:s,children:e.jsxs(K,{className:"w-[95vw] max-w-none top-[20%] translate-y-0",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ae,{className:"h-5 w-5"}),c("modals.missionDetails.title")]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"mission-name",className:"text-sm font-medium",children:c("modals.missionDetails.missionName")}),e.jsx(Pe,{id:"mission-name",placeholder:c("modals.missionDetails.placeholder"),value:d,onChange:i=>r(i.target.value),className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c("modals.missionDetails.emptyWillUseDateTime")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx($,{htmlFor:"share-data",className:"text-sm font-medium",children:c("modals.missionDetails.shareData")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground pr-4",children:c("modals.missionDetails.contributeToDatabase")}),e.jsx(qe,{id:"share-data",checked:o,onCheckedChange:n})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-2",children:[e.jsx(y,{variant:"outline",onClick:()=>s(!1),className:"h-12 text-sm",children:c("modals.missionDetails.cancel")}),e.jsxs(y,{variant:"destructive",onClick:g,className:"h-12 text-sm flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),c("modals.missionDetails.delete")]}),e.jsx(y,{onClick:l,className:"h-12 text-sm",children:c("modals.missionDetails.save")})]})]})]})})}function Xe({}){const{t}=L(),{toast:s}=ae(),{createEvent:d,isLoading:r}=ce(),{isRecording:o}=te(),{user:n}=Ee(),[l,g]=a.useState(!1),[c,i]=a.useState(""),[u,f]=a.useState(""),h=async()=>{if(!c){s({title:"Missing Information",description:"Please select an event type.",variant:"destructive"});return}if(!o){s({title:"No Active Recording",description:"Please start a recording session first.",variant:"destructive"});return}try{let m,w,p;if(navigator.geolocation)try{const N=await new Promise((F,v)=>{navigator.geolocation.getCurrentPosition(F,v,{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4})});m=N.coords.latitude,w=N.coords.longitude,p=N.coords.accuracy}catch(N){console.log("Could not get location:",N)}const _={missionId:"current-recording",eventType:c,comment:u.trim()||void 0,latitude:m,longitude:w,accuracy:p,timestamp:O()};await d(_);const k=re.find(N=>N.value===c);s({title:"Event Recorded",description:`${k?.icon} ${k?.label} event saved`}),i(""),f(""),g(!1)}catch(m){console.error("Error saving event:",m)}},b=()=>{i(""),f(""),g(!1)};return e.jsxs(W,{open:l,onOpenChange:g,children:[e.jsx(Re,{asChild:!0,children:e.jsx("button",{className:ee("h-16 w-16 rounded-full flex items-center justify-center transition-all duration-200","hover:scale-105 active:scale-95 shadow-xl","bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-2xl","touch-manipulation",!o&&"opacity-50 cursor-not-allowed"),disabled:!o||r,type:"button",children:e.jsx(Q,{className:"h-6 w-6"})})}),e.jsxs(K,{className:"max-w-md max-h-[90vh] overflow-y-auto w-[95vw] sm:w-full mx-4 sm:mx-0",children:[e.jsx(H,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Record Event"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Event Type *"]}),e.jsxs(de,{value:c,onValueChange:i,children:[e.jsx(me,{children:e.jsx(xe,{placeholder:"Select event type..."})}),e.jsx(ue,{children:re.map(m=>e.jsx(he,{value:m.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:m.icon}),e.jsx("span",{children:m.label})]})},m.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Comment (Optional)"]}),e.jsx(Me,{value:u,onChange:m=>f(m.target.value),placeholder:"Add any additional details about this event...",rows:3})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(se,{variant:"outline",className:"text-xs",children:[Z(O())," ‚Ä¢ Recording Session"]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(y,{onClick:b,variant:"outline",className:"flex-1",children:"Cancel"}),e.jsx(y,{onClick:h,className:"flex-1",disabled:r,children:r?"Saving...":"Save Event"})]})]})]})]})}function Je({device:t,isConnected:s=!1,connectionStatus:d={connected:!1,connecting:!1,error:null},locationEnabled:r=!1,latestLocation:o=null,onConnect:n=()=>{},onDisconnect:l=()=>{},onRequestLocationPermission:g=async()=>!1,className:c}){const{t:i}=L(),{toast:u}=ae(),f=te(),{dialogs:h,openDialog:b,closeDialog:m,getOnOpenChange:w}=Fe({frequency:!1,mission:!1,connection:!1}),[p,_]=a.useState("10s"),[k,N]=a.useState(""),[F,v]=a.useState(!1),[R,G]=a.useState(0),{startRecording:V,stopRecording:X,isRecording:D,recordingData:C,saveMission:P}=f,q=C.length>0?C[0]?.timestamp:null;a.useEffect(()=>{s&&h.connection&&(m("connection"),b("frequency"))},[s,h.connection,m,b]),a.useEffect(()=>{let x;return D&&q?x=setInterval(()=>{const j=O(),S=Math.floor((j.getTime()-q.getTime())/1e3);G(S)},1e3):G(0),()=>{x&&clearInterval(x)}},[D,q]);const A=x=>{const j=Math.floor(x/3600),S=Math.floor(x%3600/60),ne=x%60;return j>0?`${j.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`:`${S.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`},J=x=>{const j=le.find(S=>S.value===x);return j?i(`modals.frequency.${j.key}`):x},M=()=>{if(!f.isConnected){b("connection");return}b("frequency")},z=()=>{m("frequency"),m("connection"),V(p),u({title:i("realTime.recording"),description:`${i("modals.recordingFrequency.chooseMeasureFrequency")} ${J(p)}`})},fe=()=>{console.log("üö®üõë === STOP RECORDING BUTTON CLICKED ==="),console.log("üõë Stop recording requested, current data:",C.length,"points"),console.log("üõë Recording data sample:",C.slice(0,2).map(x=>({pm25:x.pmData.pm25,timestamp:x.timestamp}))),console.log("üõë Recording start time:",q),console.log("üõë Is currently recording:",D),X(),b("mission")},pe=async()=>{let x=k.trim();if(!x){const j=O();x=`Mission ${j.toLocaleDateString("fr-FR")} ${j.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`}try{console.log("üö®üíæ === CONFIRM STOP RECORDING CALLED ==="),console.log("üîÑ Saving mission:",x,"with current recording data:",C.length,"points"),console.log("üîÑ Recording start time available:",!!q),console.log("üîÑ Data sample before save:",C.slice(0,1).map(S=>({pm25:S.pmData.pm25,timestamp:S.timestamp})));const j=await P(x,void 0,void 0,p,F,C);console.log("‚úÖ Mission saved successfully"),m("mission"),u({title:i("history.export"),description:`"${x}" ${i("history.export")}`}),N(""),v(!1)}catch(j){console.error("‚ùå Error saving mission:",j);const S=j instanceof Error?j.message:i("analysis.error");u({title:i("analysis.error"),description:S,variant:"destructive"})}},je=()=>{console.log("üóëÔ∏è Mission discarded by user"),m("mission"),N(""),v(!1),u({title:i("modals.missionDetails.delete"),description:i("modals.missionDetails.discarded")})},ve=()=>{h.mission||h.frequency||(D?fe():M())};return e.jsxs("div",{className:ee("flex items-center gap-4 justify-end",c),children:[D?e.jsxs("div",{className:"flex items-center gap-2 bg-card px-3 py-2 rounded-lg border shadow-sm",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:A(R)})]}):e.jsx("div",{className:"flex items-center gap-2 bg-card px-3 py-2 rounded-lg border shadow-sm",children:e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Start"})}),e.jsx("button",{onClick:ve,className:ee("h-16 w-16 rounded-full flex items-center justify-center transition-all duration-200","hover:scale-105 active:scale-95 shadow-xl",D?"bg-destructive text-destructive-foreground animate-slow-pulse":"bg-green-500 text-white hover:shadow-2xl hover:bg-green-600"),type:"button",children:D?e.jsx(Ie,{className:"h-6 w-6"}):e.jsx("div",{className:"w-3 h-3 bg-background rounded-full"})}),e.jsx(Xe,{}),e.jsx(He,{open:h.frequency,onOpenChange:w("frequency"),recordingFrequency:p,onFrequencyChange:_,onConfirm:z}),e.jsx(Ye,{open:h.mission,onOpenChange:w("mission"),missionName:k,onMissionNameChange:N,shareData:F,onShareDataChange:v,onConfirm:pe,onDiscard:je}),e.jsx(Ue,{open:h.connection,onOpenChange:w("connection"),connectionStatus:d,deviceInfo:t||{name:"",connected:!1,battery:0,charging:!1,version:0,mode:0,interval:0},locationEnabled:r,latestLocation:o,onConnect:n,onDisconnect:l,onRequestLocationPermission:g})]})}const Ze=a.lazy(()=>U(()=>import("./MapGraphToggle-C7STPTe7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49])).then(t=>({default:t.MapGraphToggle}))),es=a.lazy(()=>U(()=>import("./ContextSelectors-BuR_LYaH.js"),__vite__mapDeps([50,1,2,14,3,4,5,6,7,8,9,10,11,38,39,28,29,30,25,31,32,33,26,51])).then(t=>({default:t.ContextSelectors}))),ss=a.lazy(()=>U(()=>import("./AutoContextDisplay-Ba7tQGL7.js"),__vite__mapDeps([52,1,2,14,3,4,5,6,7,8,9,10,11,34,23,19,24,25,26,30,31,32,33,35,53])).then(t=>({default:t.AutoContextDisplay}))),ts=a.lazy(()=>U(()=>import("./DataLogger-KGSUJsGo.js"),__vite__mapDeps([54,1,2,3,4,5,6,7,8,9,10,11,14,34,23,19,24,25,26,30,31,32,33,35,53,55,38,39])).then(t=>({default:t.DataLogger})));function as(){const[t,s]=a.useState(!1),[d,r]=a.useState(navigator.onLine),[o,n]=a.useState(!1),[l,g]=a.useState([]),{t:c}=L();ae(),a.useEffect(()=>{a.startTransition(()=>{s(!0)})},[]);const i=te(),{currentData:u,isConnected:f,device:h,error:b,requestDevice:m,disconnect:w,isRecording:p,recordingData:_,missionContext:k,startRecording:N,updateMissionContext:F,latestLocation:v,locationEnabled:R}=i,{settings:G}=be(we.AUTO_CONTEXT_SETTINGS,{enabled:!1});Se(p&&t&&G.enabled,v);const{fetchWeatherData:V}=Ce();ce();const{forceContextUpdate:X,autoContextEnabled:D}=Te({recordingFrequency:"10s",isRecording:p&&t}),{checkAlerts:C}=ye(),[P,q]=a.useState(()=>localStorage.getItem("recording-location")||k.location||""),[A,J]=a.useState(()=>localStorage.getItem("recording-activity")||k.activity||"");return a.useEffect(()=>{},[D,X,t]),a.useEffect(()=>{u&&t&&C(u.pm1,u.pm25,u.pm10)},[u,C,t]),a.useEffect(()=>{v&&t&&V(v)},[v,V,t]),a.useEffect(()=>{P&&localStorage.setItem("recording-location",P)},[P]),a.useEffect(()=>{A&&localStorage.setItem("recording-activity",A)},[A]),a.useEffect(()=>{R||i.requestLocationPermission?.().catch(M=>{console.log("GPS permission request failed:",M)})},[R,i.requestLocationPermission]),a.useEffect(()=>{const M=()=>r(!0),z=()=>r(!1);return window.addEventListener("online",M),window.addEventListener("offline",z),()=>{window.removeEventListener("online",M),window.removeEventListener("offline",z)}},[]),a.useEffect(()=>{p||localStorage.removeItem("recording-confirmed")},[p]),t?e.jsxs("main",{role:"main",className:"min-h-screen bg-background px-2 sm:px-4 py-4 sm:py-6",children:[e.jsx("h1",{className:"sr-only",children:"AirSentinels - Real-time Air Quality Monitoring"}),e.jsxs("div",{className:"relative",children:[p||localStorage.getItem("recording-confirmed")==="true"?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-64 bg-muted/20 rounded-lg animate-pulse mb-4"}),children:e.jsx(Ze,{showGraph:o,onToggleView:n,isOnline:d,latestLocation:v,currentData:u,recordingData:_,events:l,isRecording:p,device:h,isConnected:f,onConnect:m,onDisconnect:w,onRequestLocationPermission:i.requestLocationPermission,locationEnabled:R})}):e.jsx(Ke,{showGraph:o,onToggleView:n,isOnline:d,device:h,isConnected:f,onConnect:m,onDisconnect:w,locationEnabled:R,latestLocation:v}),e.jsx(Je,{device:h,isConnected:f,connectionStatus:{connected:f,connecting:!1,error:null},locationEnabled:R,latestLocation:v,onConnect:m,onDisconnect:w,onRequestLocationPermission:i.requestLocationPermission,className:"absolute bottom-4 right-4 z-10"})]}),e.jsx(We,{currentData:u,isConnected:f}),e.jsx("div",{className:"mb-4 context-selector",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-20 bg-muted/20 rounded-lg animate-pulse"}),children:e.jsx(es,{selectedLocation:P,onLocationChange:q,selectedActivity:A,onActivityChange:J,isRecording:p})})}),e.jsx("div",{className:"mb-4 auto-context-display",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-16 bg-muted/20 rounded-lg animate-pulse"}),children:e.jsx(ss,{})})}),e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"h-32 bg-muted/20 rounded-lg animate-pulse mb-4"}),children:e.jsx(ts,{isRecording:p,currentData:u,currentLocation:v,missionContext:{location:P,activity:A},className:"mb-4"})})]}):e.jsx("div",{className:"min-h-screen bg-background px-2 sm:px-4 py-4 sm:py-6",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"AirSentinels"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement des donn√©es de qualit√© de l'air..."}),e.jsx("div",{className:"mt-4 w-8 h-8 bg-primary/20 rounded-full animate-pulse mx-auto"})]})})}const Rs=Object.freeze(Object.defineProperty({__proto__:null,default:as},Symbol.toStringTag,{value:"Module"}));export{Rs as R,Ge as T};
