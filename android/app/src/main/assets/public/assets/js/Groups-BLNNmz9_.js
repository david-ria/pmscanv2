import{j as e}from"./query-BewfWFH7.js";import{r as N}from"./vendor-CRCfYjC_.js";import{c as we,u as Ce,B as f,b as D,g as oe,X as ke}from"./index-DnKT6hDb.js";import{C as F,b as le,c as ce,a as $,d as Ae}from"./card-CRF2Wp6a.js";import{u as ae,a as de}from"./useGroups-DlFUXECJ.js";import{D as De,a as Se,b as Te,c as Ge,e as Le,f as Me}from"./dialog-DfKWiEIF.js";import{F as o,a as l,b as m,c,d as y,P as G,e as Fe,f as q,T as $e,t as Ie,I as Ee}from"./InviteUserDialog-ItlMVMUP.js";import{I as v}from"./input-CGNY8--s.js";import{T as me,S as z,a as W,b as B,c as V,d as b}from"./select-BZrd-goH.js";import{S}from"./switch-DiHL1fOt.js";import{T as Oe,a as Pe,b as L,c as M}from"./tabs-D4ABolrV.js";import{S as he}from"./separator-auhcLEBW.js";import{u as H,b as Re,o as O,c as T,s as C,n as A,d as Y,e as re}from"./ui-forms-BvHfx7SG.js";import{supabase as U}from"./client-zGYq1VIw.js";import{u as xe}from"./useUserRole-B8Vd-TTd.js";import{M as ue,B as pe}from"./badge-D3qJDj1M.js";import{T as I}from"./trash-2-fnkO6k_f.js";import{A as qe}from"./activity-B8rwkEHL.js";import{S as Ue,D as ze,a as We,b as Be,c as ie,L as Ve}from"./dropdown-menu-BEnxxNd8.js";import{B as He}from"./bell-qdBZ5gP3.js";import{Link as Ye,useNavigate as Xe}from"./router-D6wdMmGF.js";import{R as Je,P as Ke,C as je,T as ge,D as fe,a as ve,A as Ne,O as ye}from"./ui-advanced-6HbTI6G8.js";import{U as E}from"./users-wub0dhV2.js";import{M as be}from"./date-CHE04W6Q.js";import{E as Qe}from"./external-link-06QHuptX.js";import{C as Ze}from"./clock-ipAbZE7G.js";import{C as es}from"./check-BbmLrf-d.js";import{u as ss}from"./i18n-DZz6YkIP.js";import{L as as}from"./lock-Ck1dDsWW.js";import"./supabase--OITQzG1.js";import"./theme-D-6-9UvQ.js";import"./ui-core-CibF-ClQ.js";import"./utils-EL5wpLGY.js";import"./notifications-6vUXhpBr.js";import"./label-Dli8bNIx.js";import"./groupConfigs-C_MEEc6R.js";import"./mail-R-xk0620.js";import"./download-DC3Z7BQM.js";import"./supabaseSafeWrapper-C24d6oy5.js";import"./chevron-right-DkkaQXkL.js";import"./circle-BxKWKjZR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=we("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),rs=()=>{const{createGroup:a}=ae(),{toast:n}=Ce(),[i,j]=N.useState(!1);return{createAdvancedGroup:async t=>{j(!0);try{const h=await a(t.name,t.description);if(!h?.id)throw new Error("Failed to create group");const{error:u}=await U.from("groups").update({subscription_tier:t.subscription_tier,custom_locations:t.custom_locations,custom_activities:null}).eq("id",h.id);if(u)throw u;const{error:p}=await U.from("group_settings").upsert({group_id:h.id,...t.settings},{onConflict:"group_id"});if(p)throw p;if(t.thresholds.length>0){const g=t.thresholds.map(k=>({group_id:h.id,...k})),{error:w}=await U.from("group_custom_thresholds").insert(g);if(w)throw w}return n({title:"Success",description:`Advanced group "${t.name}" created successfully with all configurations`}),h}catch(h){throw n({title:"Error",description:h instanceof Error?h.message:"Failed to create advanced group",variant:"destructive"}),h}finally{j(!1)}},isSubmitting:i}};function is({locationIndex:a,onRemoveLocation:n,form:i}){const{fields:j,append:_,remove:t}=H({control:i.control,name:`custom_locations.${a}.activities`}),h=()=>{_({name:"Walking",description:"Walking around the location",icon:"activity"})};return e.jsxs("div",{className:"border rounded-lg p-6 space-y-6 bg-card",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),e.jsxs("h4",{className:"text-lg font-medium",children:["Location ",a+1]})]}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:n,children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:i.control,name:`custom_locations.${a}.name`,render:({field:u})=>e.jsxs(l,{children:[e.jsx(m,{children:"Location Name"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Office, Home, Park...",...u})}),e.jsx(y,{})]})}),e.jsx(o,{control:i.control,name:`custom_locations.${a}.description`,render:({field:u})=>e.jsxs(l,{children:[e.jsx(m,{children:"Description"}),e.jsx(c,{children:e.jsx(me,{placeholder:"Describe this location...",className:"resize-none",...u})}),e.jsx(y,{})]})})]}),e.jsx(he,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-primary"}),e.jsx("h5",{className:"font-medium",children:"Activities at this location"})]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:h,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Activity"]})]}),j.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"No activities defined for this location yet."}):e.jsx("div",{className:"space-y-4",children:j.map((u,p)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4 bg-muted/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h6",{className:"text-sm font-medium",children:["Activity ",p+1]}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>t(p),children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o,{control:i.control,name:`custom_locations.${a}.activities.${p}.name`,render:({field:g})=>e.jsxs(l,{children:[e.jsx(m,{children:"Activity Name"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Walking, Work, Sport...",...g})}),e.jsx(y,{})]})}),e.jsx(o,{control:i.control,name:`custom_locations.${a}.activities.${p}.description`,render:({field:g})=>e.jsxs(l,{children:[e.jsx(m,{children:"Description"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Brief description...",...g})}),e.jsx(y,{})]})}),e.jsx(o,{control:i.control,name:`custom_locations.${a}.activities.${p}.icon`,render:({field:g})=>e.jsxs(l,{children:[e.jsx(m,{children:"Icon"}),e.jsx(c,{children:e.jsxs(z,{value:g.value,onValueChange:g.onChange,children:[e.jsx(W,{children:e.jsx(B,{placeholder:"Choose an icon"})}),e.jsxs(V,{children:[e.jsx(b,{value:"briefcase",children:"Briefcase"}),e.jsx(b,{value:"home",children:"Home"}),e.jsx(b,{value:"car",children:"Car"}),e.jsx(b,{value:"activity",children:"Activity"}),e.jsx(b,{value:"coffee",children:"Coffee"}),e.jsx(b,{value:"users",children:"Users"}),e.jsx(b,{value:"walk",children:"Walk"}),e.jsx(b,{value:"bike",children:"Bike"}),e.jsx(b,{value:"utensils",children:"Dining"})]})]})}),e.jsx(y,{})]})})]})]},u.id))})]})]})}const ns=O({name:C().min(1,"Threshold name is required"),pm1_min:A().min(0).max(500).optional(),pm1_max:A().min(0).max(500).optional(),pm25_min:A().min(0).max(500).optional(),pm25_max:A().min(0).max(500).optional(),pm10_min:A().min(0).max(500).optional(),pm10_max:A().min(0).max(500).optional(),color:C(),enabled:T()}),os=O({name:C().min(1,"Activity name is required"),description:C().optional(),icon:C().optional()}),ls=O({name:C().min(1,"Location name is required"),description:C().optional(),activities:Y(os).default([])}),cs=O({name:C().min(1,"Group name is required").max(100,"Group name must be less than 100 characters"),description:C().max(500,"Description must be less than 500 characters").optional(),subscription_tier:re(["free","premium"]).default("free"),pm1_threshold:A().min(0).max(500).default(15),pm25_threshold:A().min(0).max(500).default(25),pm10_threshold:A().min(0).max(500).default(50),alarm_enabled:T().default(!0),auto_share_stats:T().default(!0),notification_frequency:re(["immediate","hourly","daily"]).default("immediate"),location_auto_detect:T().default(!1),activity_auto_suggest:T().default(!1),event_notifications:T().default(!0),weekly_reports:T().default(!1),default_location:C().optional(),default_activity:C().optional(),thresholds:Y(ns).default([]),custom_locations:Y(ls).default([])});function ds({open:a,onOpenChange:n}){const{createAdvancedGroup:i,isSubmitting:j}=rs(),{isSuperAdmin:_}=xe(),t=Re({resolver:Ie(cs),defaultValues:{name:"",description:"",subscription_tier:"free",pm1_threshold:15,pm25_threshold:25,pm10_threshold:50,alarm_enabled:!0,auto_share_stats:!0,notification_frequency:"immediate",location_auto_detect:!1,activity_auto_suggest:!1,event_notifications:!0,weekly_reports:!1,thresholds:[],custom_locations:[]}}),{fields:h,append:u,remove:p}=H({control:t.control,name:"thresholds"}),{fields:g,append:w,remove:k}=H({control:t.control,name:"custom_locations"}),te=()=>{u({name:"Good",pm25_max:25,pm10_max:50,pm1_max:15,color:"#22c55e",enabled:!0})},P=()=>{w({name:"Office",description:"Workplace environment",activities:[{name:"Work",description:"Work-related activities",icon:"briefcase"}]})},R=async s=>{try{const d={name:s.name,description:s.description,subscription_tier:s.subscription_tier,settings:{pm1_threshold:s.pm1_threshold,pm25_threshold:s.pm25_threshold,pm10_threshold:s.pm10_threshold,alarm_enabled:s.alarm_enabled,auto_share_stats:s.auto_share_stats,notification_frequency:s.notification_frequency,location_auto_detect:s.location_auto_detect,activity_auto_suggest:s.activity_auto_suggest,event_notifications:s.event_notifications,weekly_reports:s.weekly_reports,default_location:s.default_location,default_activity:s.default_activity},thresholds:s.thresholds.map(r=>({name:r.name,pm1_min:r.pm1_min,pm1_max:r.pm1_max,pm25_min:r.pm25_min,pm25_max:r.pm25_max,pm10_min:r.pm10_min,pm10_max:r.pm10_max,color:r.color,enabled:r.enabled})),custom_locations:s.custom_locations.map(r=>({name:r.name,description:r.description,activities:r.activities.map(x=>({name:x.name,description:x.description,icon:x.icon}))}))};await i(d),t.reset(),n(!1)}catch{}};return _?e.jsx(De,{open:a,onOpenChange:n,children:e.jsxs(Se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Te,{children:[e.jsxs(Ge,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-5 w-5"}),"Create Advanced Group Configuration"]}),e.jsx(Le,{children:"Configure a comprehensive group with custom thresholds, locations, activities, and settings."})]}),e.jsx(Fe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(R),className:"space-y-6",children:[e.jsxs(Oe,{defaultValue:"basic",className:"w-full",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-4",children:[e.jsx(L,{value:"basic",children:"Basic Info"}),e.jsx(L,{value:"settings",children:"Settings"}),e.jsx(L,{value:"thresholds",children:"Thresholds"}),e.jsx(L,{value:"locations",children:"Locations & Activities"})]}),e.jsx(M,{value:"basic",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{control:t.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"Group Name"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Enter group name",...s})}),e.jsx(q,{children:"Choose a descriptive name for your group"}),e.jsx(y,{})]})}),e.jsx(o,{control:t.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"Description"}),e.jsx(c,{children:e.jsx(me,{placeholder:"Describe the purpose of this group",className:"resize-none",...s})}),e.jsx(q,{children:"Help members understand the group's purpose"}),e.jsx(y,{})]})}),e.jsx(o,{control:t.control,name:"subscription_tier",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"Subscription Tier"}),e.jsx(c,{children:e.jsxs(z,{value:s.value,onValueChange:s.onChange,children:[e.jsx(W,{children:e.jsx(B,{})}),e.jsxs(V,{children:[e.jsx(b,{value:"free",children:"Free"}),e.jsx(b,{value:"premium",children:"Premium"})]})]})}),e.jsx(q,{children:"Choose the subscription tier for this group"}),e.jsx(y,{})]})})]})}),e.jsx(M,{value:"settings",className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Alarm Settings"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(o,{control:t.control,name:"pm1_threshold",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"PM1 Threshold (μg/m³)"}),e.jsx(c,{children:e.jsx(v,{type:"number",...s,onChange:d=>s.onChange(Number(d.target.value))})}),e.jsx(y,{})]})}),e.jsx(o,{control:t.control,name:"pm25_threshold",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"PM2.5 Threshold (μg/m³)"}),e.jsx(c,{children:e.jsx(v,{type:"number",...s,onChange:d=>s.onChange(Number(d.target.value))})}),e.jsx(y,{})]})}),e.jsx(o,{control:t.control,name:"pm10_threshold",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"PM10 Threshold (μg/m³)"}),e.jsx(c,{children:e.jsx(v,{type:"number",...s,onChange:d=>s.onChange(Number(d.target.value))})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:"alarm_enabled",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Enable Alarms"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Send notifications when thresholds are exceeded"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(o,{control:t.control,name:"notification_frequency",render:({field:s})=>e.jsxs(l,{children:[e.jsx(m,{children:"Notification Frequency"}),e.jsx(c,{children:e.jsxs(z,{value:s.value,onValueChange:s.onChange,children:[e.jsx(W,{children:e.jsx(B,{})}),e.jsxs(V,{children:[e.jsx(b,{value:"immediate",children:"Immediate"}),e.jsx(b,{value:"hourly",children:"Hourly"}),e.jsx(b,{value:"daily",children:"Daily"})]})]})}),e.jsx(y,{})]})})]})]}),e.jsx(he,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Additional Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:"auto_share_stats",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Auto-share Statistics"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automatically share daily statistics"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(o,{control:t.control,name:"location_auto_detect",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Auto-detect Location"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automatically suggest location based on GPS"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(o,{control:t.control,name:"activity_auto_suggest",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Auto-suggest Activity"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Suggest activity based on movement patterns"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(o,{control:t.control,name:"event_notifications",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Event Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Send notifications for group events"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(o,{control:t.control,name:"weekly_reports",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Weekly Reports"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Generate weekly air quality reports"})]}),e.jsx(c,{children:e.jsx(S,{checked:s.value,onCheckedChange:s.onChange})})]})})]})]})]})}),e.jsx(M,{value:"thresholds",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Custom Thresholds"})]}),e.jsxs(f,{type:"button",variant:"outline",onClick:te,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Threshold"]})]}),h.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No custom thresholds defined. Add thresholds to override default WHO standards."}):e.jsx("div",{className:"space-y-4",children:h.map((s,d)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-medium",children:["Threshold ",d+1]}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(d),children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:`thresholds.${d}.name`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(m,{children:"Name"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Good, Moderate, Poor...",...r})}),e.jsx(y,{})]})}),e.jsx(o,{control:t.control,name:`thresholds.${d}.color`,render:({field:r})=>e.jsxs(l,{children:[e.jsx(m,{children:"Color"}),e.jsx(c,{children:e.jsx(v,{type:"color",...r})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"PM1 Range (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(o,{control:t.control,name:`thresholds.${d}.pm1_min`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Min",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})}),e.jsx(o,{control:t.control,name:`thresholds.${d}.pm1_max`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Max",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"PM2.5 Range (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(o,{control:t.control,name:`thresholds.${d}.pm25_min`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Min",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})}),e.jsx(o,{control:t.control,name:`thresholds.${d}.pm25_max`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Max",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"PM10 Range (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(o,{control:t.control,name:`thresholds.${d}.pm10_min`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Min",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})}),e.jsx(o,{control:t.control,name:`thresholds.${d}.pm10_max`,render:({field:r})=>e.jsx(l,{children:e.jsx(c,{children:e.jsx(v,{type:"number",placeholder:"Max",...r,onChange:x=>r.onChange(x.target.value?Number(x.target.value):void 0)})})})})]})]})]}),e.jsx(o,{control:t.control,name:`thresholds.${d}.enabled`,render:({field:r})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Enable Threshold"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Use this threshold for display and notifications"})]}),e.jsx(c,{children:e.jsx(S,{checked:r.value,onCheckedChange:r.onChange})})]})})]},s.id))})]})}),e.jsx(M,{value:"locations",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Locations & Activities"})]}),e.jsxs(f,{type:"button",variant:"outline",onClick:P,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Location"]})]}),g.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No locations defined. Each location can have multiple activities associated with it."}):e.jsx("div",{className:"space-y-6",children:g.map((s,d)=>e.jsx(is,{locationIndex:d,onRemoveLocation:()=>k(d),form:t},s.id))})]})})]}),e.jsxs(Me,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:j,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:j,children:j?"Creating Advanced Group...":"Create Advanced Group"})]})]})})]})}):null}const ne=Je,ms=Ke,_e=N.forwardRef(({className:a,...n},i)=>e.jsx(ye,{className:D("fixed inset-0 z-50 bg-overlay data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:i}));_e.displayName=ye.displayName;const X=N.forwardRef(({className:a,...n},i)=>e.jsxs(ms,{children:[e.jsx(_e,{}),e.jsx(je,{ref:i,className:D("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]}));X.displayName=je.displayName;const J=({className:a,...n})=>e.jsx("div",{className:D("flex flex-col space-y-2 text-center sm:text-left",a),...n});J.displayName="AlertDialogHeader";const K=({className:a,...n})=>e.jsx("div",{className:D("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...n});K.displayName="AlertDialogFooter";const Q=N.forwardRef(({className:a,...n},i)=>e.jsx(ge,{ref:i,className:D("text-lg font-semibold",a),...n}));Q.displayName=ge.displayName;const Z=N.forwardRef(({className:a,...n},i)=>e.jsx(fe,{ref:i,className:D("text-sm text-muted-foreground",a),...n}));Z.displayName=fe.displayName;const ee=N.forwardRef(({className:a,...n},i)=>e.jsx(Ne,{ref:i,className:D(oe(),a),...n}));ee.displayName=Ne.displayName;const se=N.forwardRef(({className:a,...n},i)=>e.jsx(ve,{ref:i,className:D(oe({variant:"outline"}),"mt-2 sm:mt-0",a),...n}));se.displayName=ve.displayName;function hs({group:a,onInviteUser:n}){const{deleteGroup:i,leaveGroup:j}=ae(),[_,t]=N.useState(!1),[h,u]=N.useState(!1),p=a.role==="admin",g=async()=>{try{await i(a.id),t(!1)}catch{}},w=async()=>{try{await j(a.id),u(!1)}catch{}};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{className:"group hover:shadow-lg transition-all duration-200 border-border/50",children:[e.jsx(le,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ce,{className:"text-xl mb-2 truncate",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description||"No description provided"})]}),e.jsxs(ze,{children:[e.jsx(We,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsx(Be,{align:"end",className:"w-40",children:p?e.jsxs(ie,{onClick:()=>t(!0),className:"text-destructive focus:text-destructive",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Delete Group"]}):e.jsxs(ie,{onClick:()=>u(!0),className:"text-destructive focus:text-destructive",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Leave Group"]})})]})]})}),e.jsx($,{className:"pt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.member_count," member",a.member_count!==1?"s":""]})]}),e.jsx(pe,{variant:p?"default":"secondary",className:"font-medium",children:p?"Admin":"Member"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",be(new Date(a.created_at),{addSuffix:!0})]}),e.jsx("div",{className:"flex pt-2",children:e.jsx(f,{asChild:!0,variant:"default",size:"sm",className:"w-full",children:e.jsxs(Ye,{to:`/groups/${a.id}`,className:"flex items-center justify-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),p?"Manage":"View Details"]})})})]})})]}),e.jsx(ne,{open:_,onOpenChange:t,children:e.jsxs(X,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Delete Group"}),e.jsxs(Z,{children:['Are you sure you want to delete "',a.name,'"? This action cannot be undone. All group data, settings, and shared statistics will be permanently deleted.']})]}),e.jsxs(K,{children:[e.jsx(se,{children:"Cancel"}),e.jsx(ee,{onClick:g,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Group"})]})]})}),e.jsx(ne,{open:h,onOpenChange:u,children:e.jsxs(X,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Leave Group"}),e.jsxs(Z,{children:['Are you sure you want to leave "',a.name,`"? You'll lose access to group settings and shared statistics. You can only rejoin if invited again.`]})]}),e.jsxs(K,{children:[e.jsx(se,{children:"Cancel"}),e.jsx(ee,{onClick:w,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Leave Group"})]})]})})]})}function xs({invitation:a}){const{acceptInvitation:n,declineInvitation:i}=de(),[j,_]=N.useState(!1),[t,h]=N.useState(!1),u=async()=>{_(!0);try{await n(a.token)}catch{}finally{_(!1)}},p=async()=>{h(!0);try{await i(a.token)}catch{}finally{h(!1)}},g=a.inviter_profile?.pseudo||`${a.inviter_profile?.first_name||""} ${a.inviter_profile?.last_name||""}`.trim()||"Unknown User",w=be(new Date(a.expires_at),{addSuffix:!0});return e.jsxs(F,{children:[e.jsx(le,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),a.group?.name]}),e.jsxs(Ae,{children:["Invited by ",g]})]}),e.jsxs(pe,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"Expires ",w]})]})}),e.jsxs($,{className:"space-y-4",children:[a.group?.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.group.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:u,disabled:j||t,className:"flex-1 gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),j?"Accepting...":"Accept"]}),e.jsxs(f,{onClick:p,disabled:j||t,variant:"outline",className:"flex-1 gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),t?"Declining...":"Decline"]})]})]})]})}function sa(){const{groups:a,loading:n}=ae(),{invitations:i,loading:j}=de(),[_,t]=N.useState(!1),[h,u]=N.useState(!1),[p,g]=N.useState(""),[w,k]=N.useState(!1),{t:te}=ss(),{isSuperAdmin:P,loading:R}=xe(),s=Xe(),d=r=>{g(r),u(!0)};return R||n||j?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(r=>e.jsx("div",{className:"h-48 bg-muted rounded-lg"},r))})]})})}):P?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Groups"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your air quality monitoring groups"})]}),e.jsxs("div",{className:"flex gap-3",children:[i.length>0&&e.jsxs(f,{variant:"outline",onClick:()=>k(!w),className:"gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Invitations (",i.length,")"]}),e.jsxs(f,{onClick:()=>t(!0),className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Create Group"]})]})]}),w&&i.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pending Invitations"}),e.jsx("div",{className:"space-y-3",children:i.map(r=>e.jsx(xs,{invitation:r},r.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["My Groups (",a.length,")"]}),a.length===0?e.jsx(F,{className:"border-dashed",children:e.jsxs($,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(E,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No groups yet"}),e.jsx("p",{className:"text-muted-foreground text-center mb-6 max-w-md",children:"Create your first group to start collaborating with others on air quality monitoring"}),e.jsxs(f,{onClick:()=>t(!0),className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Create Your First Group"]})]})}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:a.map(r=>e.jsx(hs,{group:r,onInviteUser:()=>d(r.id)},r.id))})]})]}),e.jsx(ds,{open:_,onOpenChange:t}),e.jsx(Ee,{open:h,onOpenChange:u,groupId:p})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:e.jsx(F,{className:"max-w-md w-full",children:e.jsxs($,{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(as,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Groups functionality is only available to super administrators. Contact your system administrator if you need access."}),e.jsx(f,{onClick:()=>s("/"),variant:"outline",children:"Return to Dashboard"})]})})})}export{sa as default};
