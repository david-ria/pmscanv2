import{j as e}from"./query-BewfWFH7.js";import{r as t}from"./vendor-CRCfYjC_.js";import{a as z,u as G,B as _}from"./index-DnKT6hDb.js";import{I as l}from"./input-CGNY8--s.js";import{C as p,b as f,c as u,a as h}from"./card-CRF2Wp6a.js";import{L as i}from"./label-Dli8bNIx.js";import{supabase as F}from"./client-zGYq1VIw.js";import{M as J}from"./MenuPageHeader-CcnmbX7d.js";import{u as K}from"./i18n-DZz6YkIP.js";import{useNavigate as O}from"./router-D6wdMmGF.js";import{U as Q}from"./user-BOWvM0oD.js";import{S as V}from"./save-DuXH8Fwl.js";import{C as W}from"./calendar-p0zw62Sr.js";import{L as H}from"./lock-Ck1dDsWW.js";import{h as L,n as D}from"./date-CHE04W6Q.js";import{f as I}from"./fr-CdMURzWB.js";import"./supabase--OITQzG1.js";import"./theme-D-6-9UvQ.js";import"./ui-core-CibF-ClQ.js";import"./utils-EL5wpLGY.js";import"./notifications-6vUXhpBr.js";import"./ui-forms-BvHfx7SG.js";import"./arrow-left-3u0J-11_.js";function ve(){const{user:n,updatePassword:T}=z(),{toast:o}=G(),{t:s,i18n:x}=K();O();const[c,k]=t.useState(null),[A,q]=t.useState(!0),[j,g]=t.useState(!1),[v,N]=t.useState(!1),[w,y]=t.useState(""),[P,b]=t.useState(""),[S,C]=t.useState(""),[d,M]=t.useState(""),[m,E]=t.useState("");t.useEffect(()=>{n&&U()},[n]);const U=async()=>{try{const{data:r,error:a}=await F.from("profiles").select("*").eq("id",n?.id).single();a?(console.error("Error fetching profile:",a),o({title:s("common.error"),description:s("profile.profileUpdateError"),variant:"destructive"})):(k(r),y(r.pseudo||""),b(r.first_name||""),C(r.last_name||""))}catch(r){console.error("Error:",r)}finally{q(!1)}},B=async r=>{r.preventDefault(),g(!0);try{const{error:a}=await F.from("profiles").update({pseudo:w.trim()||null,first_name:P.trim()||null,last_name:S.trim()||null}).eq("id",n?.id);a?o({title:s("common.error"),description:a.message,variant:"destructive"}):(o({title:s("profile.profileUpdated"),description:s("profile.infoSaved")}),U())}catch{o({title:s("common.error"),description:s("auth.unexpectedError"),variant:"destructive"})}finally{g(!1)}},R=async r=>{if(r.preventDefault(),d!==m){o({title:s("common.error"),description:s("profile.passwordsNoMatch"),variant:"destructive"});return}if(d.length<6){o({title:s("common.error"),description:s("profile.passwordTooShort"),variant:"destructive"});return}N(!0);try{const{error:a}=await T(d);a?o({title:s("common.error"),description:a.message,variant:"destructive"}):(o({title:s("profile.passwordChanged"),description:s("profile.passwordUpdated")}),M(""),E(""))}catch{o({title:s("common.error"),description:s("auth.unexpectedError"),variant:"destructive"})}finally{N(!1)}};return A?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("profile.loadingProfile")})]})}):e.jsx("div",{className:"min-h-screen bg-background px-4 py-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx(J,{title:s("profile.title"),subtitle:s("profile.subtitle")}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),s("profile.personalInfo")]})}),e.jsx(h,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pseudo",children:s("profile.pseudo")}),e.jsx(l,{id:"pseudo",placeholder:s("profile.pseudoPlaceholder"),value:w,onChange:r=>y(r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"firstName",children:s("profile.firstName")}),e.jsx(l,{id:"firstName",placeholder:s("profile.firstNamePlaceholder"),value:P,onChange:r=>b(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lastName",children:s("profile.lastName")}),e.jsx(l,{id:"lastName",placeholder:s("profile.lastNamePlaceholder"),value:S,onChange:r=>C(r.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:s("profile.email")}),e.jsx(l,{value:n?.email||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("profile.emailNotEditable")})]}),e.jsxs(_,{type:"submit",disabled:j,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),s(j?"profile.saving":"profile.save")]})]})})]}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),s("profile.accountInfo")]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:s("profile.connectedSince")}),e.jsx("p",{className:"text-muted-foreground",children:c?.created_at?L(new Date(c.created_at),"dd MMMM yyyy à HH:mm",{locale:x.language==="fr"?I:D}):s("profile.notAvailable")})]}),e.jsxs("div",{children:[e.jsx(i,{className:"text-sm font-medium",children:s("profile.lastUpdate")}),e.jsx("p",{className:"text-muted-foreground",children:c?.updated_at?L(new Date(c.updated_at),"dd MMMM yyyy à HH:mm",{locale:x.language==="fr"?I:D}):s("profile.notAvailable")})]})]})})]}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),s("profile.changePassword")]})}),e.jsx(h,{children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"newPassword",children:s("profile.newPassword")}),e.jsx(l,{id:"newPassword",type:"password",placeholder:s("auth.passwordPlaceholder"),value:d,onChange:r=>M(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirmPassword",children:s("profile.confirmPassword")}),e.jsx(l,{id:"confirmPassword",type:"password",placeholder:s("auth.passwordPlaceholder"),value:m,onChange:r=>E(r.target.value)})]}),e.jsxs(_,{type:"submit",disabled:v||!d||!m,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),s(v?"profile.changing":"profile.changePassword")]})]})})]})]})})}export{ve as default};
