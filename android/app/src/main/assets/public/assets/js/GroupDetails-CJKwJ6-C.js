import{j as e}from"./query-BewfWFH7.js";import{r as v}from"./vendor-CRCfYjC_.js";import{c as Z,u as J,B as f,a as he}from"./index-DnKT6hDb.js";import{C as M,a as G,b as q,c as B}from"./card-CRF2Wp6a.js";import{B as $,M as se}from"./badge-D3qJDj1M.js";import{S as ye}from"./separator-auhcLEBW.js";import{u as ce,b as be}from"./useGroups-DlFUXECJ.js";import{u as Ce}from"./useUserRole-B8Vd-TTd.js";import{u as le}from"./useSubscription-DJEgHQrc.js";import{a as H}from"./useDialog-D4PBCj81.js";import{D as T,a as P,b as z,c as O,e as K,f as pe}from"./dialog-DfKWiEIF.js";import{supabase as D}from"./client-zGYq1VIw.js";import{e as je,F as A,a as S,b as E,c as L,d as F,t as ge,T as ae,P as I,I as we}from"./InviteUserDialog-ItlMVMUP.js";import{I as w}from"./input-CGNY8--s.js";import{S as V}from"./switch-DiHL1fOt.js";import{b as ve,z as k}from"./ui-forms-BvHfx7SG.js";import{T as R}from"./trash-2-fnkO6k_f.js";import{L as C}from"./label-Dli8bNIx.js";import{T as te,S as _e,a as ke,b as Ae,c as Se,d as ee}from"./select-BZrd-goH.js";import{B as re}from"./bell-qdBZ5gP3.js";import{C as Ee}from"./chart-column-BZUAHE40.js";import{C as ie}from"./calendar-p0zw62Sr.js";import{A as de}from"./activity-B8rwkEHL.js";import{C as ne}from"./crown-zbULqoOE.js";import{useParams as Le,useNavigate as De}from"./router-D6wdMmGF.js";import{A as Y}from"./arrow-left-3u0J-11_.js";import{L as Me}from"./loader-circle-CMvZ_kLu.js";import{U as Ge}from"./users-wub0dhV2.js";import{U as Fe}from"./user-plus-BWbi5Krx.js";import{C as Te}from"./chevron-right-DkkaQXkL.js";import"./supabase--OITQzG1.js";import"./theme-D-6-9UvQ.js";import"./ui-core-CibF-ClQ.js";import"./utils-EL5wpLGY.js";import"./notifications-6vUXhpBr.js";import"./i18n-DZz6YkIP.js";import"./ui-advanced-6HbTI6G8.js";import"./supabaseSafeWrapper-C24d6oy5.js";import"./tabs-D4ABolrV.js";import"./groupConfigs-C_MEEc6R.js";import"./mail-R-xk0620.js";import"./download-DC3Z7BQM.js";import"./check-BbmLrf-d.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Z("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Z("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Z("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=Z("Vibrate",[["path",{d:"m2 8 2 2-2 2 2 2-2 2",key:"sv1b1"}],["path",{d:"m22 8-2 2 2 2-2 2 2 2",key:"101i4y"}],["rect",{width:"8",height:"14",x:"8",y:"5",rx:"1",key:"1oyrl4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Z("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Z("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ue=k.object({name:k.string().min(1,"Group name is required").max(100,"Name too long"),description:k.string().max(500,"Description too long").optional()});function qe({group:c,open:l,onOpenChange:m}){const{toast:h}=J(),[N,x]=v.useState(!1),i=ve({resolver:ge(Ue),defaultValues:{name:c.name||"",description:c.description||""}});v.useEffect(()=>{l&&c&&i.reset({name:c.name||"",description:c.description||""})},[l,c,i]);const y=async r=>{x(!0);try{const{error:p}=await D.from("groups").update({name:r.name,description:r.description||null,updated_at:new Date().toISOString()}).eq("id",c.id);if(p)throw p;h({title:"Success",description:"Group information updated successfully"}),m(!1),window.location.reload()}catch(p){h({title:"Error",description:p instanceof Error?p.message:"Failed to update group information",variant:"destructive"})}finally{x(!1)}};return e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Edit Group Information"]}),e.jsx(K,{children:"Update the basic information for your group."})]}),e.jsx(je,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(y),className:"space-y-4",children:[e.jsx(A,{control:i.control,name:"name",render:({field:r})=>e.jsxs(S,{children:[e.jsx(E,{children:"Group Name *"}),e.jsx(L,{children:e.jsx(w,{placeholder:"Enter group name",...r})}),e.jsx(F,{})]})}),e.jsx(A,{control:i.control,name:"description",render:({field:r})=>e.jsxs(S,{children:[e.jsx(E,{children:"Description"}),e.jsx(L,{children:e.jsx(te,{placeholder:"Optional group description",className:"resize-none",rows:3,...r})}),e.jsx(F,{})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:N,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:N,children:N?"Saving...":"Save Changes"})]})]})})]})})}const Ne=c=>{const[l,m]=v.useState([]),[h,N]=v.useState(!0),{toast:x}=J(),i=async()=>{if(c)try{const{data:s,error:a}=await D.from("group_custom_thresholds").select("*").eq("group_id",c).order("name");if(a)throw a;m(s||[])}catch{x({title:"Error",description:"Failed to fetch group thresholds",variant:"destructive"})}finally{N(!1)}},y=async s=>{try{const{error:a}=await D.from("group_custom_thresholds").insert(s);if(a)throw a;x({title:"Success",description:"Group threshold created successfully"}),await i()}catch(a){throw x({title:"Error",description:a instanceof Error?a.message:"Failed to create group threshold",variant:"destructive"}),a}},r=async(s,a)=>{try{const{error:d}=await D.from("group_custom_thresholds").update(a).eq("id",s);if(d)throw d;x({title:"Success",description:"Group threshold updated successfully"}),await i()}catch(d){throw x({title:"Error",description:d instanceof Error?d.message:"Failed to update group threshold",variant:"destructive"}),d}},p=async s=>{try{const{error:a}=await D.from("group_custom_thresholds").delete().eq("id",s);if(a)throw a;x({title:"Success",description:"Group threshold deleted successfully"}),await i()}catch(a){throw x({title:"Error",description:a instanceof Error?a.message:"Failed to delete group threshold",variant:"destructive"}),a}};return v.useEffect(()=>{i()},[c]),{thresholds:l,loading:h,createThreshold:y,updateThreshold:r,deleteThreshold:p,refetch:i}},Be=k.object({name:k.string().min(1,"Le nom est requis"),pm1_min:k.number().min(0).max(500).optional(),pm1_max:k.number().min(0).max(500).optional(),pm25_min:k.number().min(0).max(500).optional(),pm25_max:k.number().min(0).max(500).optional(),pm10_min:k.number().min(0).max(500).optional(),pm10_max:k.number().min(0).max(500).optional(),color:k.string(),enabled:k.boolean()});function Ve({group:c,threshold:l,open:m,onOpenChange:h}){const{createThreshold:N,updateThreshold:x}=Ne(c.id),[i,y]=v.useState(!1),r=ve({resolver:ge(Be),defaultValues:{name:"",pm1_min:void 0,pm1_max:void 0,pm25_min:void 0,pm25_max:void 0,pm10_min:void 0,pm10_max:void 0,color:"#3b82f6",enabled:!0}});v.useEffect(()=>{l?r.reset({name:l.name,pm1_min:l.pm1_min||void 0,pm1_max:l.pm1_max||void 0,pm25_min:l.pm25_min||void 0,pm25_max:l.pm25_max||void 0,pm10_min:l.pm10_min||void 0,pm10_max:l.pm10_max||void 0,color:l.color,enabled:l.enabled}):r.reset({name:"",pm1_min:void 0,pm1_max:void 0,pm25_min:void 0,pm25_max:void 0,pm10_min:void 0,pm10_max:void 0,color:"#3b82f6",enabled:!0})},[l,r]);const p=async s=>{y(!0);try{const a={group_id:c.id,name:s.name,pm1_min:s.pm1_min||void 0,pm1_max:s.pm1_max||void 0,pm25_min:s.pm25_min||void 0,pm25_max:s.pm25_max||void 0,pm10_min:s.pm10_min||void 0,pm10_max:s.pm10_max||void 0,color:s.color,enabled:s.enabled};l?await x(l.id,a):await N(a),h(!1)}catch{}finally{y(!1)}};return e.jsx(T,{open:m,onOpenChange:h,children:e.jsxs(P,{className:"w-[95vw]",children:[e.jsxs(z,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),l?"Modifier le seuil":"Ajouter un seuil"]}),e.jsx(K,{children:l?"Modifiez les paramètres du seuil":"Créez un nouveau seuil personnalisé pour le groupe"})]}),e.jsx(je,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(p),className:"space-y-4",children:[e.jsx(A,{control:r.control,name:"name",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Nom du seuil"}),e.jsx(L,{children:e.jsx(w,{placeholder:"Bon, Modéré, Mauvais...",...s})}),e.jsx(F,{})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsx(A,{control:r.control,name:"color",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Couleur"}),e.jsx(L,{children:e.jsx(w,{type:"color",...s})}),e.jsx(F,{})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Seuils PM1 (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{control:r.control,name:"pm1_min",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Min"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"0",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})}),e.jsx(A,{control:r.control,name:"pm1_max",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Max"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"∞",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Seuils PM2.5 (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{control:r.control,name:"pm25_min",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Min"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"0",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})}),e.jsx(A,{control:r.control,name:"pm25_max",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Max"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"∞",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Seuils PM10 (μg/m³)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{control:r.control,name:"pm10_min",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Min"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"0",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})}),e.jsx(A,{control:r.control,name:"pm10_max",render:({field:s})=>e.jsxs(S,{children:[e.jsx(E,{children:"Max"}),e.jsx(L,{children:e.jsx(w,{type:"number",placeholder:"∞",...s,onChange:a=>s.onChange(a.target.value?parseFloat(a.target.value):void 0)})}),e.jsx(F,{})]})})]})]}),e.jsx(A,{control:r.control,name:"enabled",render:({field:s})=>e.jsxs(S,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(E,{children:"Activer le seuil"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Utiliser ce seuil pour l'affichage et les notifications"})]}),e.jsx(L,{children:e.jsx(V,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Annuler"}),e.jsx(f,{type:"submit",disabled:i,children:i?"Enregistrement...":l?"Modifier":"Créer"})]})]})})]})})}function Ie({group:c,open:l,onOpenChange:m}){const{thresholds:h,loading:N,deleteThreshold:x}=Ne(c.id),[i,y]=v.useState(!1),[r,p]=v.useState(),s=n=>{p(n),y(!0)},a=()=>{p(void 0),y(!0)},d=()=>{y(!1),p(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(z,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Seuils Personnalisés - ",c.name]}),e.jsx(K,{children:"Gérez les seuils personnalisés pour ce groupe"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Seuils du groupe"}),e.jsxs(f,{onClick:a,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Ajouter un seuil"]})]}),N?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>e.jsx("div",{className:"h-24 bg-muted rounded animate-pulse"},n))}):h.length===0?e.jsx(M,{children:e.jsxs(G,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun seuil personnalisé"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"Créez des seuils personnalisés pour ce groupe afin de mieux surveiller la qualité de l'air"}),e.jsxs(f,{onClick:a,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Créer le premier seuil"]})]})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:h.map(n=>e.jsxs(M,{className:"relative",children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:n.color}}),n.name]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>s(n),children:e.jsx(ze,{className:"h-3 w-3"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x(n.id),children:e.jsx(R,{className:"h-3 w-3"})})]})]}),e.jsx($,{variant:n.enabled?"default":"secondary",className:"w-fit",children:n.enabled?"Actif":"Inactif"})]}),e.jsxs(G,{className:"space-y-2",children:[n.pm1_min!==void 0||n.pm1_max!==void 0?e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"PM1:"})," ",n.pm1_min||0," - ",n.pm1_max||"∞"," ","μg/m³"]}):null,n.pm25_min!==void 0||n.pm25_max!==void 0?e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"PM2.5:"})," ",n.pm25_min||0," -"," ",n.pm25_max||"∞"," μg/m³"]}):null,n.pm10_min!==void 0||n.pm10_max!==void 0?e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"PM10:"})," ",n.pm10_min||0," -"," ",n.pm10_max||"∞"," μg/m³"]}):null]})]},n.id))})]})]})}),e.jsx(Ve,{group:c,threshold:r,open:i,onOpenChange:d})]})}function $e(c){const{user:l}=he(),{toast:m}=J(),[h,N]=v.useState([]),[x,i]=v.useState(!1),y=v.useCallback(async()=>{if(!(!c||!l)){i(!0);try{const{data:d,error:n}=await D.from("group_settings").select("custom_alarms").eq("group_id",c).single();if(n)throw n;N(d?.custom_alarms||[])}catch(d){console.error("Error fetching group alarms:",d),m({title:"Error",description:"Failed to fetch group alarms",variant:"destructive"})}finally{i(!1)}}},[c,l,m]),r=v.useCallback(async d=>{if(!(!c||!l))try{const{error:n}=await D.from("group_settings").update({custom_alarms:d}).eq("group_id",c);if(n)throw n;N(d),m({title:"Success",description:"Alarms updated successfully"})}catch(n){console.error("Error saving alarms:",n),m({title:"Error",description:"Failed to save alarms",variant:"destructive"})}},[c,l,m]),p=v.useCallback(async d=>{const n={...d,id:crypto.randomUUID()},t=[...h,n];await r(t)},[h,r]),s=v.useCallback(async(d,n)=>{const t=h.map(o=>o.id===d?{...o,...n}:o);await r(t)},[h,r]),a=v.useCallback(async d=>{const n=h.filter(t=>t.id!==d);await r(n)},[h,r]);return v.useEffect(()=>{y()},[y]),{alarms:h,loading:x,createAlarm:p,updateAlarm:s,deleteAlarm:a,refetch:y}}function He({groupId:c,open:l,onOpenChange:m}){const{alarms:h,createAlarm:N,updateAlarm:x,deleteAlarm:i}=$e(c),{features:y}=le(),[r,p]=v.useState(!1),[s,a]=v.useState({name:"",pollutant:"pm25",threshold:25,enabled:!0,sound_enabled:!0,vibration_enabled:!0,color:"#ef4444"}),d=async()=>{s.name.trim()&&(await N(s),a({name:"",pollutant:"pm25",threshold:25,enabled:!0,sound_enabled:!0,vibration_enabled:!0,color:"#ef4444"}),p(!1))},n={pm1:"PM1.0",pm25:"PM2.5",pm10:"PM10"};return y.customAlarms?e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(O,{children:"Group Alarms"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[h.map(t=>e.jsxs(M,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{className:"text-lg",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:t.enabled?"default":"secondary",style:{backgroundColor:t.enabled?t.color:void 0},children:[n[t.pollutant]," > ",t.threshold," μg/m³"]}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>i(t.id),children:e.jsx(R,{className:"h-4 w-4"})})]})]})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Threshold"}),e.jsx(w,{type:"number",value:t.threshold,onChange:o=>x(t.id,{threshold:Number(o.target.value)})})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Color"}),e.jsx(w,{type:"color",value:t.color,onChange:o=>x(t.id,{color:o.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:t.sound_enabled,onCheckedChange:o=>x(t.id,{sound_enabled:o})}),e.jsxs(C,{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),"Sound"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:t.vibration_enabled,onCheckedChange:o=>x(t.id,{vibration_enabled:o})}),e.jsxs(C,{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),"Vibration"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:t.enabled,onCheckedChange:o=>x(t.id,{enabled:o})}),e.jsx(C,{children:"Enabled"})]})]})]},t.id)),h.length===0&&!r&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No custom alarms configured. Create your first alarm to get started."})]}),r?e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(B,{children:"Create New Alarm"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Alarm Name"}),e.jsx(w,{value:s.name,onChange:t=>a(o=>({...o,name:t.target.value})),placeholder:"High PM2.5 Alert"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Pollutant"}),e.jsxs(_e,{value:s.pollutant,onValueChange:t=>a(o=>({...o,pollutant:t})),children:[e.jsx(ke,{children:e.jsx(Ae,{})}),e.jsxs(Se,{children:[e.jsx(ee,{value:"pm1",children:"PM1.0"}),e.jsx(ee,{value:"pm25",children:"PM2.5"}),e.jsx(ee,{value:"pm10",children:"PM10"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Threshold (μg/m³)"}),e.jsx(w,{type:"number",value:s.threshold,onChange:t=>a(o=>({...o,threshold:Number(t.target.value)}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Color"}),e.jsx(w,{type:"color",value:s.color,onChange:t=>a(o=>({...o,color:t.target.value}))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:s.sound_enabled,onCheckedChange:t=>a(o=>({...o,sound_enabled:t}))}),e.jsxs(C,{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),"Sound"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:s.vibration_enabled,onCheckedChange:t=>a(o=>({...o,vibration_enabled:t}))}),e.jsxs(C,{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),"Vibration"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:d,disabled:!s.name.trim(),children:"Create Alarm"}),e.jsx(f,{variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})]}):e.jsxs(f,{onClick:()=>p(!0),variant:"outline",className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add New Alarm"]})]})]})}):e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(O,{children:"Premium Feature"})}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Custom alarms are available in Premium and Enterprise plans."}),e.jsx(f,{onClick:()=>m(!1),children:"Close"})]})]})})}function Re({group:c,open:l,onOpenChange:m}){const[h,N]=v.useState(!1),[x,i]=v.useState(!1),y=()=>{N(!0)},r=()=>{i(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Monitoring Settings - ",c.name]}),e.jsx(K,{children:"Configure pollution thresholds and automated alerts for your group"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-6 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:y,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Ee,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Custom Thresholds"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set pollution level ranges specific to your group's needs"})]})]})}),e.jsx("div",{className:"p-6 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:r,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(re,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Automated Alarms"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set up alerts when pollution levels exceed your limits"})]})]})})]})]})}),e.jsx(Ie,{group:c,open:h,onOpenChange:N}),e.jsx(He,{groupId:c.id,open:x,onOpenChange:i})]})}function Ze(c){const{user:l}=he(),{toast:m}=J(),[h,N]=v.useState([]),[x,i]=v.useState(!1),y=v.useCallback(async()=>{if(!(!c||!l)){i(!0);try{const{data:a,error:d}=await D.from("group_events").select("*").eq("group_id",c).order("name");if(d)throw d;N(a||[])}catch(a){console.error("Error fetching group events:",a),m({title:"Error",description:"Failed to fetch group events",variant:"destructive"})}finally{i(!1)}}},[c,l,m]),r=v.useCallback(async a=>{if(!(!c||!l))try{const{data:d,error:n}=await D.from("group_events").insert({group_id:c,...a}).select().single();if(n)throw n;return N(t=>[...t,d]),m({title:"Success",description:"Event type created successfully"}),d}catch(d){console.error("Error creating event:",d),m({title:"Error",description:"Failed to create event type",variant:"destructive"})}},[c,l,m]),p=v.useCallback(async(a,d)=>{if(l)try{const{data:n,error:t}=await D.from("group_events").update(d).eq("id",a).select().single();if(t)throw t;return N(o=>o.map(W=>W.id===a?n:W)),m({title:"Success",description:"Event type updated successfully"}),n}catch(n){console.error("Error updating event:",n),m({title:"Error",description:"Failed to update event type",variant:"destructive"})}},[l,m]),s=v.useCallback(async a=>{if(l)try{const{error:d}=await D.from("group_events").delete().eq("id",a);if(d)throw d;N(n=>n.filter(t=>t.id!==a)),m({title:"Success",description:"Event type deleted successfully"})}catch(d){console.error("Error deleting event:",d),m({title:"Error",description:"Failed to delete event type",variant:"destructive"})}},[l,m]);return v.useEffect(()=>{y()},[y]),{events:h,loading:x,createEvent:r,updateEvent:p,deleteEvent:s,refetch:y}}function Je({groupId:c,open:l,onOpenChange:m}){const{events:h,createEvent:N,updateEvent:x,deleteEvent:i}=Ze(c),{features:y}=le(),[r,p]=v.useState(!1),[s,a]=v.useState({name:"",description:"",icon:"calendar",color:"#3b82f6",enabled:!0}),d=async()=>{s.name.trim()&&(await N(s),a({name:"",description:"",icon:"calendar",color:"#3b82f6",enabled:!0}),p(!1))},n=["calendar","circle","square","triangle","star","heart","flag","alert-circle","info","check-circle","x-circle"];return y.customEvents?e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(O,{children:"Group Event Types"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[h.map(t=>e.jsxs(M,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5",style:{color:t.color}}),t.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:t.enabled?"default":"secondary",children:t.enabled?"Active":"Disabled"}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>i(t.id),children:e.jsx(R,{className:"h-4 w-4"})})]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Event Name"}),e.jsx(w,{value:t.name,onChange:o=>x(t.id,{name:o.target.value})})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Icon"}),e.jsx(w,{value:t.icon,onChange:o=>x(t.id,{icon:o.target.value}),placeholder:"calendar"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Color"}),e.jsx(w,{type:"color",value:t.color,onChange:o=>x(t.id,{color:o.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Description"}),e.jsx(te,{value:t.description||"",onChange:o=>x(t.id,{description:o.target.value}),placeholder:"Optional description of this event type",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:t.enabled,onCheckedChange:o=>x(t.id,{enabled:o})}),e.jsx(C,{children:"Enabled"})]})]})]},t.id)),h.length===0&&!r&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No custom event types configured. Create your first event type to get started."})]}),r?e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(B,{children:"Create New Event Type"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Event Name"}),e.jsx(w,{value:s.name,onChange:t=>a(o=>({...o,name:t.target.value})),placeholder:"Traffic Incident"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Icon"}),e.jsx(w,{value:s.icon,onChange:t=>a(o=>({...o,icon:t.target.value})),placeholder:"calendar"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:n.map(t=>e.jsx(f,{size:"sm",variant:"outline",onClick:()=>a(o=>({...o,icon:t})),className:"text-xs h-6",children:t},t))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Color"}),e.jsx(w,{type:"color",value:s.color,onChange:t=>a(o=>({...o,color:t.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Description"}),e.jsx(te,{value:s.description,onChange:t=>a(o=>({...o,description:t.target.value})),placeholder:"Optional description of this event type",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:d,disabled:!s.name.trim(),children:"Create Event Type"}),e.jsx(f,{variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})]}):e.jsxs(f,{onClick:()=>p(!0),variant:"outline",className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add New Event Type"]})]})]})}):e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(O,{children:"Premium Feature"})}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Custom event types are available in Premium and Enterprise plans."}),e.jsx(f,{onClick:()=>m(!1),children:"Close"})]})]})})}function We({groupId:c,open:l,onOpenChange:m}){const{groups:h,updateGroup:N}=ce(),{toast:x}=J(),[i,y]=v.useState(!1),[r,p]=v.useState({name:"",activities:[""]}),s=h.find(u=>u.id===c),a=s?.custom_locations?Object.entries(s.custom_locations).map(([u,j])=>({id:u,name:j.name||u,activities:Array.isArray(j.activities)?j.activities.filter(g=>typeof g=="string"):[]})):[],d=async()=>{if(!r.name.trim())return;const u=r.activities.filter(b=>typeof b=="string"&&b.trim());if(u.length===0)return;const j=crypto.randomUUID(),_={...s?.custom_locations||{},[j]:{name:r.name,activities:u}};try{await N(c,{custom_locations:_}),p({name:"",activities:[""]}),y(!1),x({title:"Success",description:"Location created successfully"})}catch{x({title:"Error",description:"Failed to create location",variant:"destructive"})}},n=async u=>{const j=s?.custom_locations||{},{[u]:g,..._}=j;try{await N(c,{custom_locations:_}),x({title:"Success",description:"Location deleted successfully"})}catch{x({title:"Error",description:"Failed to delete location",variant:"destructive"})}},t=async(u,j)=>{const g=s?.custom_locations||{},_={...g,[u]:{...g[u],...j}};try{await N(c,{custom_locations:_}),x({title:"Success",description:"Location updated successfully"})}catch{x({title:"Error",description:"Failed to update location",variant:"destructive"})}},o=(u,j)=>{j([...u,""])},W=(u,j,g)=>{const _=j.filter((b,U)=>U!==u);g(_)},oe=(u,j,g,_)=>{const b=[...g];b[u]=j,_(b)};return e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(O,{children:"Group Locations & Activities"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[a.map(u=>e.jsxs(M,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-primary"}),u.name]}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>n(u.id),children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Location Name"}),e.jsx(w,{value:u.name,onChange:j=>t(u.id,{name:j.target.value})})]}),e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center gap-1 mb-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Activities"]}),e.jsxs("div",{className:"space-y-2",children:[u.activities.map((j,g)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:j,onChange:_=>{const b=[...u.activities];b[g]=_.target.value,t(u.id,{activities:b})},placeholder:"Activity name"}),u.activities.length>1&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>{const _=u.activities.filter((b,U)=>U!==g);t(u.id,{activities:_})},children:e.jsx(R,{className:"h-4 w-4"})})]},g)),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{const j=[...u.activities,""];t(u.id,{activities:j})},children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Add Activity"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:u.activities.filter(j=>typeof j=="string"&&j.trim()).map((j,g)=>e.jsx($,{variant:"secondary",children:j},g))})]})]})]},u.id)),a.length===0&&!i&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No locations configured. Create your first location to get started."})]}),i?e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(B,{children:"Create New Location"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Location Name"}),e.jsx(w,{value:r.name,onChange:u=>p(j=>({...j,name:u.target.value})),placeholder:"Office, Lab, Home, etc."})]}),e.jsxs("div",{children:[e.jsxs(C,{className:"flex items-center gap-1 mb-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Activities"]}),e.jsxs("div",{className:"space-y-2",children:[r.activities.map((u,j)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:u,onChange:g=>oe(j,g.target.value,r.activities,_=>p(b=>({...b,activities:_}))),placeholder:"Activity name"}),r.activities.length>1&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>W(j,r.activities,g=>p(_=>({..._,activities:g}))),children:e.jsx(R,{className:"h-4 w-4"})})]},j)),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>o(r.activities,u=>p(j=>({...j,activities:u}))),children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Add Activity"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:d,disabled:!r.name.trim()||!r.activities.some(u=>typeof u=="string"&&u.trim()),children:"Create Location"}),e.jsx(f,{variant:"outline",onClick:()=>y(!1),children:"Cancel"})]})]})]}):e.jsxs(f,{onClick:()=>y(!0),variant:"outline",className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add New Location"]})]})]})})}const ue=[{id:"free",level:"Level 1",name:"Basic Access",description:"Standard group monitoring capabilities",features:["Up to 10 members","Basic monitoring","Standard locations & activities","Basic event tracking"],icon:Pe,color:"text-muted-foreground",bgColor:"bg-muted/20"},{id:"premium",level:"Level 2",name:"Enhanced Access",description:"Advanced group monitoring features",features:["Up to 50 members","Custom pollution thresholds","Advanced automated alerts","Custom event types","Enhanced analytics"],icon:Oe,color:"text-accent-foreground",bgColor:"bg-accent/20"},{id:"enterprise",level:"Level 3",name:"Full Access",description:"Complete enterprise functionality",features:["Unlimited members","Advanced custom thresholds","Real-time automated alerts","Custom event management","Advanced analytics & reporting","API access","Custom integrations"],icon:ne,color:"text-primary-foreground",bgColor:"bg-primary/20"}];function Ye({group:c,open:l,onOpenChange:m}){const[h,N]=v.useState(c?.subscription_tier||"free"),{updateGroup:x}=ce(),{toast:i}=J(),[y,r]=v.useState(!1),p=async s=>{if(!(s===h||y)){r(!0);try{await x(c.id,{subscription_tier:s}),N(s),i({title:"Access level updated",description:`Group access level changed to ${ue.find(a=>a.id===s)?.level}`})}catch{i({title:"Failed to update access level",description:"Please try again later",variant:"destructive"})}finally{r(!1)}}};return e.jsx(T,{open:l,onOpenChange:m,children:e.jsxs(P,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(z,{children:[e.jsx(O,{className:"text-xl font-bold text-center",children:"Group Access Levels"}),e.jsx("p",{className:"text-center text-muted-foreground text-sm",children:"Select an access level to change group functionalities"})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-3",children:ue.map(s=>{const a=s.id===h;return e.jsxs(M,{className:`relative transition-all duration-200 ${a?"border-2 border-primary shadow-lg":"border hover:border-accent hover:shadow-md cursor-pointer"}`,onClick:()=>!a&&p(s.id),children:[a&&e.jsx($,{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-primary text-primary-foreground",children:"Current"}),e.jsxs(q,{className:"text-center pb-3",children:[e.jsx("div",{className:`w-12 h-12 mx-auto rounded-lg ${s.bgColor} flex items-center justify-center mb-2`,children:e.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})}),e.jsx(B,{className:"text-lg",children:s.level}),e.jsx("h3",{className:"text-sm font-semibold",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsxs(G,{className:"pt-0",children:[e.jsx("div",{className:"space-y-2 mb-4",children:s.features.map((d,n)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500 mt-1.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:d})]},n))}),!a&&e.jsx(f,{className:"w-full",variant:"outline",disabled:y,onClick:d=>{d.stopPropagation(),p(s.id)},children:y?"Updating...":"Select Level"})]})]},s.id)})})]})})}function qs(){const{groupId:c}=Le(),l=De(),{groups:m,loading:h}=ce(),{isSuperAdmin:N}=Ce(),{features:x}=le(),[i,y]=v.useState(null),r=H(),p=H(),s=H(),a=H(),d=H(),n=H();v.useEffect(()=>{if(!h&&m.length>0&&c){let g=m.find(_=>_.id===c);if(!g&&c&&(!c.includes("-")||c.split("-").length<5)){const _=c.replace(/-/g," ").replace(/\b\w/g,b=>b.toUpperCase());if(g=m.find(b=>b.name.toLowerCase()===_.toLowerCase()||b.name.toLowerCase().replace(/\s+/g,"-")===c.toLowerCase()),!g){const b=c.split("-"),U=b[b.length-1];/^[0-9a-f]{8}$/i.test(U)&&(g=m.find(Q=>Q.id.startsWith(U)))}}y(g||null)}},[m,h,c]);const{members:t,loading:o}=be(i?.id);if(h||!i&&!h)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs(f,{variant:"ghost",onClick:()=>l("/groups"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Groups"]})}),e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(Me,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]})});if(!i)return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs(f,{variant:"ghost",onClick:()=>l("/groups"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Groups"]})}),e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Group Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The group you're looking for doesn't exist or you don't have access to it."})]})]})});if(!(i.role==="admin"||N))return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs(f,{variant:"ghost",onClick:()=>l(N?"/groups":"/"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to ",N?"Groups":"Dashboard"]})}),e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to manage this group."})]})]})});i.member_quota&&Math.round(t.length/i.member_quota*100);const u=g=>{switch(g){case"enterprise":return"bg-primary text-primary-foreground";case"premium":return"bg-accent text-accent-foreground";default:return"bg-muted text-muted-foreground"}},j=({icon:g,title:_,description:b,onClick:U,isPremium:Q=!1,disabled:X=!1})=>e.jsx(M,{className:`cursor-pointer transition-all hover:shadow-md ${X?"opacity-50":""}`,onClick:X?void 0:U,children:e.jsx(G,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-muted rounded-lg",children:e.jsx(g,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:_}),Q&&!x.customAlarms&&e.jsx(ne,{className:"h-4 w-4 text-accent"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b})]})]}),!X&&e.jsx(Te,{className:"h-5 w-5 text-muted-foreground"})]})})});return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(f,{variant:"ghost",onClick:()=>l("/groups"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Groups"]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:i.name}),e.jsx(f,{variant:"ghost",size:"sm",onClick:a.openDialog,className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(fe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-muted-foreground",children:i.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsxs("span",{children:[o?"...":t.length," member",t.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs("span",{children:["Created ",new Date(i.created_at).toLocaleDateString()]})]}),i.custom_locations&&typeof i.custom_locations=="object"&&Object.keys(i.custom_locations).length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsxs("span",{children:[Object.keys(i.custom_locations).length," location",Object.keys(i.custom_locations).length!==1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($,{className:`cursor-pointer transition-colors hover:opacity-80 ${u(i.subscription_tier||"free")}`,onClick:n.openDialog,children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),(i.subscription_tier||"free").toUpperCase()," Plan"]}),e.jsxs(f,{onClick:d.openDialog,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Invite Member"]})]})]})}),e.jsx(ye,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Group Management"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(j,{icon:re,title:"Monitoring Settings",description:"Manage pollution thresholds and automated alerts",onClick:r.openDialog}),e.jsx(j,{icon:se,title:"Locations & Activities",description:"Configure custom locations and activity types for your group",onClick:s.openDialog}),e.jsx(j,{icon:ie,title:"Event Types",description:"Create custom event types for enhanced data collection",onClick:p.openDialog,isPremium:!0,disabled:!x.customAlarms})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Recent Members"}),e.jsx(f,{variant:"outline",size:"sm",children:"View All"})]}),e.jsx("div",{className:"grid gap-3",children:o?e.jsx("p",{className:"text-muted-foreground",children:"Loading members..."}):t.slice(0,3).map(g=>e.jsx(M,{children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[g.profiles?.first_name," ",g.profiles?.last_name]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Joined ",new Date(g.joined_at).toLocaleDateString()]})]}),e.jsx($,{variant:g.role==="admin"?"default":"secondary",children:g.role})]})})},g.id))})]}),e.jsx(qe,{group:i,open:a.open,onOpenChange:a.setOpen}),e.jsx(Re,{group:i,open:r.open,onOpenChange:r.setOpen}),e.jsx(Je,{groupId:i.id,open:p.open,onOpenChange:p.setOpen}),e.jsx(We,{groupId:i.id,open:s.open,onOpenChange:s.setOpen}),e.jsx(we,{groupId:i.id,open:d.open,onOpenChange:d.setOpen}),e.jsx(Ye,{group:i,open:n.open,onOpenChange:n.setOpen})]})})}export{qs as default};
