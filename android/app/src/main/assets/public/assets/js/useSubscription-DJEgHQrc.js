import{r as e}from"./vendor-CRCfYjC_.js";import{a as T}from"./index-DnKT6hDb.js";import{supabase as E}from"./client-zGYq1VIw.js";import{u as y}from"./useGroups-DlFUXECJ.js";import{u as D}from"./useUserRole-B8Vd-TTd.js";const U={free:{canUseLocationEnrichment:!1,canUseWeatherData:!1,canUseAutoContext:!1,hasCustomLists:!1,customAlarms:!1,customEvents:!1,maxMeasurementsPerDay:100,maxGroupsAllowed:1},premium:{canUseLocationEnrichment:!0,canUseWeatherData:!0,canUseAutoContext:!0,hasCustomLists:!0,customAlarms:!0,customEvents:!0,maxMeasurementsPerDay:1e3,maxGroupsAllowed:5},enterprise:{canUseLocationEnrichment:!0,canUseWeatherData:!0,canUseAutoContext:!0,hasCustomLists:!0,customAlarms:!0,customEvents:!0}};function v(){const{user:i}=T(),{groups:f,loading:p,error:m}=y(),{isSuperAdmin:b}=D(),[l,r]=e.useState("free"),[x,s]=e.useState(!0),[A,u]=e.useState(null),a=e.useMemo(()=>f?.map(t=>t.id)||[],[f]),d=e.useCallback(async()=>{if(!i?.id){r("free"),s(!1);return}if(!p)try{u(null);const{data:t,error:n}=await E.from("profiles").select("subscription_tier").eq("id",i.id).single();if(n){if(n.code==="PGRST116"){r("free"),s(!1);return}console.error("Error fetching user subscription:",n),u("Failed to fetch subscription data"),r("free"),s(!1);return}let c=t?.subscription_tier||"free";if(a.length>0&&!m){const{data:h,error:L}=await E.from("groups").select("subscription_tier").in("id",a);if(!L&&h){const g={enterprise:3,premium:2,free:1},C=h.map(o=>o.subscription_tier);for(const o of C)g[o]>g[c]&&(c=o)}}r(c)}catch(t){console.error("Unexpected error fetching subscription:",t),u("Unexpected error occurred"),r("free")}finally{s(!1)}},[i?.id,a,p,m]);e.useEffect(()=>{d()},[d]);const S=b?U.enterprise:U[l];return{tier:l,features:S,loading:x,error:A}}export{v as u};
