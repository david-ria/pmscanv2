import{r as o}from"./vendor-CRCfYjC_.js";import{a as g}from"./index-DnKT6hDb.js";import{z as t}from"./ui-forms-BvHfx7SG.js";import"./client-zGYq1VIw.js";import{o as U}from"./supabaseSafeWrapper-C24d6oy5.js";const _=t.enum(["super_admin","admin","moderator","user"]);t.object({targetUserId:t.string().uuid("Invalid user ID format"),newRole:_.refine(r=>r!=="super_admin",{message:"Super admin role cannot be assigned through this function"}),changeReason:t.string().min(10,"Change reason must be at least 10 characters").max(500,"Change reason too long")});t.object({targetEmail:t.string().email("Invalid email format")});const R=async r=>{try{const e=await U.rpc("get_user_role",{_user_id:r});return e.error?{success:!1,error:e.isOffline?"Unable to check user role while offline":e.error}:{success:!0,role:e.data||"user"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}};function k(){const{user:r}=g(),[e,n]=o.useState(null),[l,u]=o.useState(!0),[m,a]=o.useState(null),i=o.useCallback(async()=>{if(!r?.id){n(null),u(!1),a(null);return}try{a(null);const s=await R(r.id);s.success?n(s.role||"user"):(console.error("Error fetching user role:",s.error),a(s.error||"Failed to fetch user role"),n("user"))}catch(s){console.error("Unexpected error fetching user role:",s),a("Unexpected error occurred"),n("user")}finally{u(!1)}},[r?.id]);o.useEffect(()=>{if(!r?.id){n(null),u(!1);return}i()},[r?.id,i]);const d=e==="super_admin",f=e==="admin"||e==="super_admin",h=e==="moderator"||e==="admin"||e==="super_admin",p=o.useCallback(s=>{if(!e||!s)return!1;const c={user:1,moderator:2,admin:3,super_admin:4};return c[e]>=c[s]},[e]);return{userRole:e,loading:l,error:m,isSuperAdmin:d,isAdmin:f,isModerator:h,hasRole:p,refetch:i}}export{k as u};
