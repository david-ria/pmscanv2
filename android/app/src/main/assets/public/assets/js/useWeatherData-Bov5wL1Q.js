import{r}from"./vendor-CRCfYjC_.js";import{a as p,r as D,d as b}from"./useAutoContext-RU6mHgIo.js";import{supabase as y}from"./client-zGYq1VIw.js";import{d as g,e as w}from"./index-DnKT6hDb.js";function I({recordingFrequency:l,isRecording:d}){const f=r.useRef(null),[c,u]=r.useState(""),{determineContext:o,updateLatestContext:t,isEnabled:e}=p(),a=r.useCallback(async(h,m,x=0,C=!1)=>{if(!e)return"";f.current=new Date;const i=await o({pmData:h,location:m,speed:x,isMoving:C}),s=i||"";return D("autocontext-determination",5e3,"ğŸ¤– Autocontext:",{ruleBasedContext:i,finalContext:s,source:"sensors and movement heuristics"}),s?(b.info("Autocontext determined",s),t(s),u(s),s):c},[e,l,o,t,c]),n=r.useCallback(async(h,m,x=0,C=!1)=>{if(!e)return;const i=await o({pmData:h,location:m,speed:x,isMoving:C});t(i||"Indoor")},[e,o,t]);return{updateContextIfNeeded:a,forceContextUpdate:n,autoContextEnabled:e}}function L(){const[l,d]=r.useState(!1),[f,c]=r.useState(null),u=r.useCallback(async(t,e)=>{if(!t?.latitude||!t?.longitude)return g(),null;d(!0);try{g("ğŸŒ¤ï¸ Fetching weather data for location:",t);const{data:a,error:n}=await y.functions.invoke("fetch-weather",{body:{latitude:t.latitude,longitude:t.longitude,timestamp:e?e.toISOString():new Date().toISOString()}});return n?(w("âŒ Error fetching weather data:",n),null):a?.weatherData?(g("âœ… Weather data fetched successfully:",a.weatherData.id),c(a.weatherData),a.weatherData):null}catch(a){return w("âŒ Error in weather data fetch:",a),null}finally{d(!1)}},[]),o=r.useCallback(async(t,e,a)=>{try{return(await u({latitude:t,longitude:e},a))?.id||null}catch(n){return w("âŒ Error getting weather for measurement:",n),null}},[u]);return{weatherData:f,isLoading:l,fetchWeatherData:u,getWeatherForMeasurement:o}}export{I as a,L as u};
