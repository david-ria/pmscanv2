import{j as e}from"./query-BewfWFH7.js";import{r as f}from"./vendor-CRCfYjC_.js";import{c as N,B as c,d as w}from"./index-DnKT6hDb.js";import{B as L}from"./badge-D3qJDj1M.js";import{a as T}from"./useAutoContext-RU6mHgIo.js";import{u as F}from"./UnifiedDataProvider-D_wn4Ile.js";import{u as k}from"./i18n-DZz6YkIP.js";import{B as A}from"./brain-BnPjMeLS.js";import{D as M}from"./download-DC3Z7BQM.js";import{C as S,e as B}from"./select-BZrd-goH.js";import"./supabase--OITQzG1.js";import"./router-D6wdMmGF.js";import"./theme-D-6-9UvQ.js";import"./ui-core-CibF-ClQ.js";import"./utils-EL5wpLGY.js";import"./notifications-6vUXhpBr.js";import"./client-zGYq1VIw.js";import"./useSubscription-DJEgHQrc.js";import"./useGroups-DlFUXECJ.js";import"./useUserRole-B8Vd-TTd.js";import"./ui-forms-BvHfx7SG.js";import"./supabaseSafeWrapper-C24d6oy5.js";import"./bluetooth-BEoGU70i.js";import"./timeFormat-CCn9v1Tp.js";import"./useMissionSaver-CXd3xg0u.js";import"./check-BbmLrf-d.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d=N("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);function ct({isRecording:x,currentData:P,currentLocation:R,missionContext:z,className:p}){const{t:i}=k(),{recordingData:l,clearRecordingData:h}=F(),{latestContext:u,isEnabled:g}=T(!1,null),[s,j]=f.useState(!1),o=Array.isArray(l)?l.slice().reverse().slice(0,100).map((t,n)=>!t||!t.pmData?null:{id:n.toString(),timestamp:t.pmData.timestamp instanceof Date?t.pmData.timestamp:new Date,pmData:t.pmData,location:t.location,missionContext:t.context,automaticContext:t.automaticContext,enrichedLocation:t.enrichedLocation,geohash:t.geohash}).filter(Boolean):[],v=Array.isArray(o)&&o.length>0&&o[0]?.automaticContext?o[0].automaticContext:u,C=()=>{h(),w()},D=async()=>{if(o.length===0)return;const n=[["Timestamp","PM1 (μg/m³)","PM2.5 (μg/m³)","PM10 (μg/m³)","Temperature (°C)","Humidity (%)","Latitude","Longitude","GPS Accuracy (m)","Location Context","Activity Context","Auto Context","Enriched Location","Geohash"].join(","),...o.map(a=>[a.timestamp.toISOString(),a.pmData.pm1.toFixed(2),a.pmData.pm25.toFixed(2),a.pmData.pm10.toFixed(2),a.pmData.temp.toFixed(2),a.pmData.humidity.toFixed(1),a.location?.latitude?.toFixed(6)||"",a.location?.longitude?.toFixed(6)||"",a.location?.accuracy?.toFixed(0)||"",a.missionContext?.location||"",a.missionContext?.activity||"",a.automaticContext||"",a.enrichedLocation||"",a.geohash||""].join(","))].join(`
`),b=new Blob([n],{type:"text/csv"}),r=URL.createObjectURL(b),m=document.createElement("a");m.href=r,m.download=`journal-donnees-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(r)};return e.jsxs("div",{className:p,children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-3 bg-card/50 border rounded-t-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium text-sm",children:i("realTime.dataLogger")}),g&&e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(L,{variant:"outline",className:"text-xs bg-muted",children:v||"Detecting..."})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[o.length>0&&e.jsxs("span",{className:"text-muted-foreground text-xs hidden sm:inline",children:[i("realTime.last"),": ",o[0]?.timestamp.toLocaleTimeString()]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:D,disabled:o.length===0,className:"h-8 w-8 p-0",title:i("realTime.export"),children:e.jsx(M,{className:"h-3 w-3"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:C,disabled:o.length===0,className:"h-8 px-2 text-xs",children:i("realTime.clear")}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>j(!s),className:"h-8 w-8 p-0",title:i(s?"realTime.expand":"realTime.minimize"),children:s?e.jsx(S,{className:"h-3 w-3"}):e.jsx(B,{className:"h-3 w-3"})})]})]}),!s&&e.jsx("div",{className:"bg-background border-x border-b rounded-b-lg p-2 sm:p-3 h-32 sm:h-40 overflow-auto animate-accordion-down",children:o.length===0?e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx(d,{className:"h-6 w-6 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:i("realTime.noData")}),e.jsx("p",{className:"text-xs mt-1",children:i(x?"realTime.waitingData":"realTime.startRecording")})]}):e.jsx("div",{className:"space-y-1 font-mono text-xs",children:o.map(t=>e.jsxs("div",{className:"text-muted-foreground break-all",children:[e.jsxs("div",{className:"text-xs",children:["[",t.timestamp.toLocaleTimeString(),"] New reading: PM1=",t.pmData.pm1.toFixed(1),"ug/m³,"]}),e.jsxs("div",{className:"text-xs pl-2",children:["PM2.5=",t.pmData.pm25.toFixed(1),"ug/m³, PM10=",t.pmData.pm10.toFixed(1),"ug/m³, Temp=",t.pmData.temp.toFixed(1),"°C"]}),t.location&&e.jsxs("div",{className:"text-xs pl-2",children:["GPS: ",t.location.latitude.toFixed(6),","," ",t.location.longitude.toFixed(6)," (+",Math.round(t.location.accuracy||0),"m)"]}),t.missionContext&&(t.missionContext.location||t.missionContext.activity)&&e.jsxs("div",{className:"text-xs pl-2",children:["Tags:"," ",[t.missionContext.location,t.missionContext.activity].filter(Boolean).join(", ")]}),t.automaticContext&&e.jsxs("div",{className:"text-xs pl-2 text-blue-400",children:["Auto: ",t.automaticContext]}),t.enrichedLocation&&e.jsxs("div",{className:"text-xs pl-2 text-green-400",children:["Location: ",t.enrichedLocation]}),t.geohash&&e.jsxs("div",{className:"text-xs pl-2 text-purple-400",children:["Geohash: ",t.geohash]})]},t.id))})}),s&&e.jsx("div",{className:"border-x border-b rounded-b-lg h-1"})]})}export{ct as DataLogger};
